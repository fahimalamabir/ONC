!function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=67)}([function(t,e){t.exports=function(t,e,r,n,o){var a={};return Object.keys(n).forEach((function(t){a[t]=n[t]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=r.slice().reverse().reduce((function(r,n){return n(t,e,r)||r}),a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(t,e,a),a=null),a}},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}},function(t,e,r){t.exports=function(){"use strict";var t="millisecond",e="second",r="minute",n="hour",o="day",a="week",i="month",s="quarter",l="year",c=/^(\d{4})-?(\d{1,2})-?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?.?(\d{1,3})?$/,u=/\[([^\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,d=function(t,e,r){var n=String(t);return!n||n.length>=e?t:""+Array(e+1-n.length).join(r)+t},h={s:d,z:function(t){var e=-t.utcOffset(),r=Math.abs(e),n=Math.floor(r/60),o=r%60;return(e<=0?"+":"-")+d(n,2,"0")+":"+d(o,2,"0")},m:function(t,e){var r=12*(e.year()-t.year())+(e.month()-t.month()),n=t.clone().add(r,i),o=e-n<0,a=t.clone().add(r+(o?-1:1),i);return Number(-(r+(e-n)/(o?n-a:a-n))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(c){return{M:i,y:l,w:a,d:o,h:n,m:r,s:e,ms:t,Q:s}[c]||String(c||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},p={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},f="en",y={};y[f]=p;var v=function(t){return t instanceof b},m=function(t,e,r){var n;if(!t)return f;if("string"==typeof t)y[t]&&(n=t),e&&(y[t]=e,n=t);else{var o=t.name;y[o]=t,n=o}return r||(f=n),n},g=function(t,e,r){if(v(t))return t.clone();var n=e?"string"==typeof e?{format:e,pl:r}:e:{};return n.date=t,new b(n)},w=h;w.l=m,w.i=v,w.w=function(t,e){return g(t,{locale:e.$L,utc:e.$u,$offset:e.$offset})};var b=function(){function d(t){this.$L=this.$L||m(t.locale,null,!0),this.parse(t)}var h=d.prototype;return h.parse=function(t){this.$d=function(t){var e=t.date,r=t.utc;if(null===e)return new Date(NaN);if(w.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var n=e.match(c);if(n)return r?new Date(Date.UTC(n[1],n[2]-1,n[3]||1,n[4]||0,n[5]||0,n[6]||0,n[7]||0)):new Date(n[1],n[2]-1,n[3]||1,n[4]||0,n[5]||0,n[6]||0,n[7]||0)}return new Date(e)}(t),this.init()},h.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},h.$utils=function(){return w},h.isValid=function(){return!("Invalid Date"===this.$d.toString())},h.isSame=function(t,e){var r=g(t);return this.startOf(e)<=r&&r<=this.endOf(e)},h.isAfter=function(t,e){return g(t)<this.startOf(e)},h.isBefore=function(t,e){return this.endOf(e)<g(t)},h.$g=function(t,e,r){return w.u(t)?this[e]:this.set(r,t)},h.year=function(t){return this.$g(t,"$y",l)},h.month=function(t){return this.$g(t,"$M",i)},h.day=function(t){return this.$g(t,"$W",o)},h.date=function(t){return this.$g(t,"$D","date")},h.hour=function(t){return this.$g(t,"$H",n)},h.minute=function(t){return this.$g(t,"$m",r)},h.second=function(t){return this.$g(t,"$s",e)},h.millisecond=function(e){return this.$g(e,"$ms",t)},h.unix=function(){return Math.floor(this.valueOf()/1e3)},h.valueOf=function(){return this.$d.getTime()},h.startOf=function(t,s){var c=this,u=!!w.u(s)||s,d=w.p(t),h=function(t,e){var r=w.w(c.$u?Date.UTC(c.$y,e,t):new Date(c.$y,e,t),c);return u?r:r.endOf(o)},p=function(t,e){return w.w(c.toDate()[t].apply(c.toDate(),(u?[0,0,0,0]:[23,59,59,999]).slice(e)),c)},f=this.$W,y=this.$M,v=this.$D,m="set"+(this.$u?"UTC":"");switch(d){case l:return u?h(1,0):h(31,11);case i:return u?h(1,y):h(0,y+1);case a:var g=this.$locale().weekStart||0,b=(f<g?f+7:f)-g;return h(u?v-b:v+(6-b),y);case o:case"date":return p(m+"Hours",0);case n:return p(m+"Minutes",1);case r:return p(m+"Seconds",2);case e:return p(m+"Milliseconds",3);default:return this.clone()}},h.endOf=function(t){return this.startOf(t,!1)},h.$set=function(a,s){var c,u=w.p(a),d="set"+(this.$u?"UTC":""),h=(c={},c[o]=d+"Date",c.date=d+"Date",c[i]=d+"Month",c[l]=d+"FullYear",c[n]=d+"Hours",c[r]=d+"Minutes",c[e]=d+"Seconds",c[t]=d+"Milliseconds",c)[u],p=u===o?this.$D+(s-this.$W):s;if(u===i||u===l){var f=this.clone().set("date",1);f.$d[h](p),f.init(),this.$d=f.set("date",Math.min(this.$D,f.daysInMonth())).toDate()}else h&&this.$d[h](p);return this.init(),this},h.set=function(t,e){return this.clone().$set(t,e)},h.get=function(t){return this[w.p(t)]()},h.add=function(t,s){var c,u=this;t=Number(t);var d=w.p(s),h=function(e){var r=g(u);return w.w(r.date(r.date()+Math.round(e*t)),u)};if(d===i)return this.set(i,this.$M+t);if(d===l)return this.set(l,this.$y+t);if(d===o)return h(1);if(d===a)return h(7);var p=(c={},c[r]=6e4,c[n]=36e5,c[e]=1e3,c)[d]||1,f=this.$d.getTime()+t*p;return w.w(f,this)},h.subtract=function(t,e){return this.add(-1*t,e)},h.format=function(t){var e=this;if(!this.isValid())return"Invalid Date";var r=t||"YYYY-MM-DDTHH:mm:ssZ",n=w.z(this),o=this.$locale(),a=this.$H,i=this.$m,s=this.$M,l=o.weekdays,c=o.months,d=function(t,n,o,a){return t&&(t[n]||t(e,r))||o[n].substr(0,a)},h=function(t){return w.s(a%12||12,t,"0")},p=o.meridiem||function(t,e,r){var n=t<12?"AM":"PM";return r?n.toLowerCase():n},f={YY:String(this.$y).slice(-2),YYYY:this.$y,M:s+1,MM:w.s(s+1,2,"0"),MMM:d(o.monthsShort,s,c,3),MMMM:c[s]||c(this,r),D:this.$D,DD:w.s(this.$D,2,"0"),d:String(this.$W),dd:d(o.weekdaysMin,this.$W,l,2),ddd:d(o.weekdaysShort,this.$W,l,3),dddd:l[this.$W],H:String(a),HH:w.s(a,2,"0"),h:h(1),hh:h(2),a:p(a,i,!0),A:p(a,i,!1),m:String(i),mm:w.s(i,2,"0"),s:String(this.$s),ss:w.s(this.$s,2,"0"),SSS:w.s(this.$ms,3,"0"),Z:n};return r.replace(u,(function(t,e){return e||f[t]||n.replace(":","")}))},h.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},h.diff=function(t,c,u){var d,h=w.p(c),p=g(t),f=6e4*(p.utcOffset()-this.utcOffset()),y=this-p,v=w.m(this,p);return v=(d={},d[l]=v/12,d[i]=v,d[s]=v/3,d[a]=(y-f)/6048e5,d[o]=(y-f)/864e5,d[n]=y/36e5,d[r]=y/6e4,d[e]=y/1e3,d)[h]||y,u?v:w.a(v)},h.daysInMonth=function(){return this.endOf(i).$D},h.$locale=function(){return y[this.$L]},h.locale=function(t,e){if(!t)return this.$L;var r=this.clone();return r.$L=m(t,e,!0),r},h.clone=function(){return w.w(this.$d,this)},h.toDate=function(){return new Date(this.valueOf())},h.toJSON=function(){return this.isValid()?this.toISOString():null},h.toISOString=function(){return this.$d.toISOString()},h.toString=function(){return this.$d.toUTCString()},d}();return g.prototype=b.prototype,g.extend=function(t,e){return t(e,b,g),g},g.locale=m,g.isDayjs=v,g.unix=function(t){return g(1e3*t)},g.en=y[f],g.Ls=y,g}()},function(t,e,r){var n=r(41),o=r(42);t.exports=function(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?o(t):e}},function(t,e){function r(e){return t.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},r(e)}t.exports=r},function(t,e,r){var n=r(43);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}},function(t,e,r){t.exports=r(61)},function(t,e,r){t.exports=function(){"use strict";return function(t,e,r){var n=(new Date).getTimezoneOffset(),o=e.prototype;r.utc=function(t,r){return new e({date:t,utc:!0,format:r})},o.utc=function(){return r(this.toDate(),{locale:this.$L,utc:!0})},o.local=function(){return r(this.toDate(),{locale:this.$L,utc:!1})};var a=o.parse;o.parse=function(t){t.utc&&(this.$u=!0),this.$utils().u(t.$offset)||(this.$offset=t.$offset),a.call(this,t)};var i=o.init;o.init=function(){if(this.$u){var t=this.$d;this.$y=t.getUTCFullYear(),this.$M=t.getUTCMonth(),this.$D=t.getUTCDate(),this.$W=t.getUTCDay(),this.$H=t.getUTCHours(),this.$m=t.getUTCMinutes(),this.$s=t.getUTCSeconds(),this.$ms=t.getUTCMilliseconds()}else i.call(this)};var s=o.utcOffset;o.utcOffset=function(t){var e=this.$utils().u;if(e(t))return this.$u?0:e(this.$offset)?s.call(this):this.$offset;var r,o=Math.abs(t)<=16?60*t:t;return 0!==t?(r=this.local().add(o+n,"minute")).$offset=o:r=this.utc(),r};var l=o.format;o.format=function(t){var e=t||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return l.call(this,e)},o.valueOf=function(){var t=this.$utils().u(this.$offset)?0:this.$offset+n;return this.$d.valueOf()-6e4*t},o.isUTC=function(){return!!this.$u},o.toISOString=function(){return this.toDate().toISOString()},o.toString=function(){return this.toDate().toUTCString()}}}()},function(t,e,r){"use strict";var n=r(14),o=r(24),a=Object.prototype.toString;function i(t){return"[object Array]"===a.call(t)}function s(t){return null!==t&&"object"==typeof t}function l(t){return"[object Function]"===a.call(t)}function c(t,e){if(null!=t)if("object"!=typeof t&&(t=[t]),i(t))for(var r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.call(null,t[o],o,t)}t.exports={isArray:i,isArrayBuffer:function(t){return"[object ArrayBuffer]"===a.call(t)},isBuffer:o,isFormData:function(t){return"undefined"!=typeof FormData&&t instanceof FormData},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:s,isUndefined:function(t){return void 0===t},isDate:function(t){return"[object Date]"===a.call(t)},isFile:function(t){return"[object File]"===a.call(t)},isBlob:function(t){return"[object Blob]"===a.call(t)},isFunction:l,isStream:function(t){return s(t)&&l(t.pipe)},isURLSearchParams:function(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:c,merge:function t(){var e={};function r(r,n){"object"==typeof e[n]&&"object"==typeof r?e[n]=t(e[n],r):e[n]=r}for(var n=0,o=arguments.length;n<o;n++)c(arguments[n],r);return e},extend:function(t,e,r){return c(e,(function(e,o){t[o]=r&&"function"==typeof e?n(e,r):e})),t},trim:function(t){return t.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(t,e,r){"use strict";const n=r(44),o=r(19);t.exports=o((function(t,e,...r){if(e.constructor===t){const e=t.name?" `"+t.name+"`":"";throw new Error("Cannot instantiate abstract class"+e)}for(const t of n(r))if(!(t in e)){const r=e.constructor&&e.constructor.name?"`"+e.constructor.name+"`":"The child class";throw new Error(r+" must define the abstract property `"+t+"`")}}))},function(t,e,r){t.exports=r(23)},function(t,e,r){"use strict";(function(e){var n=r(9),o=r(27),a={"Content-Type":"application/x-www-form-urlencoded"};function i(t,e){!n.isUndefined(t)&&n.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var s,l={adapter:("undefined"!=typeof XMLHttpRequest?s=r(15):void 0!==e&&(s=r(15)),s),transformRequest:[function(t,e){return o(e,"Content-Type"),n.isFormData(t)||n.isArrayBuffer(t)||n.isBuffer(t)||n.isStream(t)||n.isFile(t)||n.isBlob(t)?t:n.isArrayBufferView(t)?t.buffer:n.isURLSearchParams(t)?(i(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):n.isObject(t)?(i(e,"application/json;charset=utf-8"),JSON.stringify(t)):t}],transformResponse:[function(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(t){}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(t){return t>=200&&t<300}};l.headers={common:{Accept:"application/json, text/plain, */*"}},n.forEach(["delete","get","head"],(function(t){l.headers[t]={}})),n.forEach(["post","put","patch"],(function(t){l.headers[t]=n.merge(a)})),t.exports=l}).call(this,r(26))},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";t.exports=function(t,e){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return t.apply(e,r)}}},function(t,e,r){"use strict";var n=r(9),o=r(28),a=r(30),i=r(31),s=r(32),l=r(16);t.exports=function(t){return new Promise((function(e,c){var u=t.data,d=t.headers;n.isFormData(u)&&delete d["Content-Type"];var h=new XMLHttpRequest;if(t.auth){var p=t.auth.username||"",f=t.auth.password||"";d.Authorization="Basic "+btoa(p+":"+f)}if(h.open(t.method.toUpperCase(),a(t.url,t.params,t.paramsSerializer),!0),h.timeout=t.timeout,h.onreadystatechange=function(){if(h&&4===h.readyState&&(0!==h.status||h.responseURL&&0===h.responseURL.indexOf("file:"))){var r="getAllResponseHeaders"in h?i(h.getAllResponseHeaders()):null,n={data:t.responseType&&"text"!==t.responseType?h.response:h.responseText,status:h.status,statusText:h.statusText,headers:r,config:t,request:h};o(e,c,n),h=null}},h.onerror=function(){c(l("Network Error",t,null,h)),h=null},h.ontimeout=function(){c(l("timeout of "+t.timeout+"ms exceeded",t,"ECONNABORTED",h)),h=null},n.isStandardBrowserEnv()){var y=r(33),v=(t.withCredentials||s(t.url))&&t.xsrfCookieName?y.read(t.xsrfCookieName):void 0;v&&(d[t.xsrfHeaderName]=v)}if("setRequestHeader"in h&&n.forEach(d,(function(t,e){void 0===u&&"content-type"===e.toLowerCase()?delete d[e]:h.setRequestHeader(e,t)})),t.withCredentials&&(h.withCredentials=!0),t.responseType)try{h.responseType=t.responseType}catch(e){if("json"!==t.responseType)throw e}"function"==typeof t.onDownloadProgress&&h.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&h.upload&&h.upload.addEventListener("progress",t.onUploadProgress),t.cancelToken&&t.cancelToken.promise.then((function(t){h&&(h.abort(),c(t),h=null)})),void 0===u&&(u=null),h.send(u)}))}},function(t,e,r){"use strict";var n=r(29);t.exports=function(t,e,r,o,a){var i=new Error(t);return n(i,e,r,o,a)}},function(t,e,r){"use strict";t.exports=function(t){return!(!t||!t.__CANCEL__)}},function(t,e,r){"use strict";function n(t){this.message=t}n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,t.exports=n},function(t,e,r){"use strict";const n=r(45),o=r(46),a=r(47),i=r(48),s=r(49),l=r(50),c=r(55),{set:u}=r(58),d=r(20);t.exports=l([2,0,1],(t,e,r)=>d(r,(function(){const{arg:l=0,path:d=e,ignoreThis:h}=c("arg",t),p=n(Array.from(arguments),l);return i(this)||a(this)||o(h,{blacklist:!0})(this)||(d?(s(p[l])||(p[l]={}),u(p[l],d,this)):p.splice(l,0,this)),r.apply(this,p)})))},function(t,e,r){"use strict";const n=r(52),o=r(53),a=r(54),i=new WeakMap,s=new WeakMap,l=/([^\n]+(?:\r?\n)?{\r?\n)([ \t]*)([\s\S]+)/;t.exports=function(t,e){if("function"!=typeof t)throw new TypeError("wfn argument 1 must be a function");if("function"!=typeof e)throw new TypeError("wfn argument 2 must be a function");const r=s.has(t)?s.get(t):String(t);s.set(e,r);const c=(i.has(t)?i.get(t):[]).concat([e.name]);i.set(e,c),n(t,e);const u=c.filter(Boolean);let d;if(u.length){const t=c.length-u.length;d=o("and",u.map(t=>t+"()").concat(t>0?[t+" other unnamed function"+a(t,"","s")]:[]))}else d=c.length+" unnamed function"+a(c.length,"","s");const h=`/* [wfn] Wrapped with ${d} */`;let p;const f=r.match(l);if(f){const[,t,e,r]=f;p=t+e+h+"\n"+e+r}else p=r.trim()+"\n"+h;return e.toString=()=>p,e}},function(t,e,r){(function(r){var n,o,a;o=[],void 0===(a="function"==typeof(n=function(){"use strict";function e(t,e,r){var n=new XMLHttpRequest;n.open("GET",t),n.responseType="blob",n.onload=function(){i(n.response,e,r)},n.onerror=function(){console.error("could not download file")},n.send()}function n(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&299>=e.status}function o(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(r){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof r&&r.global===r?r:void 0,i=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype?function(t,r,i){var s=a.URL||a.webkitURL,l=document.createElement("a");r=r||t.name||"download",l.download=r,l.rel="noopener","string"==typeof t?(l.href=t,l.origin===location.origin?o(l):n(l.href)?e(t,r,i):o(l,l.target="_blank")):(l.href=s.createObjectURL(t),setTimeout((function(){s.revokeObjectURL(l.href)}),4e4),setTimeout((function(){o(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(t,r,a){if(r=r||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(function(t,e){return void 0===e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}(t,a),r);else if(n(t))e(t,r,a);else{var i=document.createElement("a");i.href=t,i.target="_blank",setTimeout((function(){o(i)}))}}:function(t,r,n,o){if((o=o||open("","_blank"))&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof t)return e(t,r,n);var i="application/octet-stream"===t.type,s=/constructor/i.test(a.HTMLElement)||a.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||i&&s)&&"object"==typeof FileReader){var c=new FileReader;c.onloadend=function(){var t=c.result;t=l?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=t:location=t,o=null},c.readAsDataURL(t)}else{var u=a.URL||a.webkitURL,d=u.createObjectURL(t);o?o.location=d:location.href=d,o=null,setTimeout((function(){u.revokeObjectURL(d)}),4e4)}});a.saveAs=i.saveAs=i,t.exports=i})?n.apply(e,o):n)||(t.exports=a)}).call(this,r(13))},function(t,e,r){var n=r(63),o=r(64),a=r(65);t.exports=function(t,e){return n(t)||o(t,e)||a()}},function(t,e,r){"use strict";var n=r(9),o=r(14),a=r(25),i=r(12);function s(t){var e=new a(t),r=o(a.prototype.request,e);return n.extend(r,a.prototype,e),n.extend(r,e),r}var l=s(i);l.Axios=a,l.create=function(t){return s(n.merge(i,t))},l.Cancel=r(18),l.CancelToken=r(39),l.isCancel=r(17),l.all=function(t){return Promise.all(t)},l.spread=r(40),t.exports=l,t.exports.default=l},function(t,e){
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
t.exports=function(t){return null!=t&&null!=t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}},function(t,e,r){"use strict";var n=r(12),o=r(9),a=r(34),i=r(35);function s(t){this.defaults=t,this.interceptors={request:new a,response:new a}}s.prototype.request=function(t){"string"==typeof t&&(t=o.merge({url:arguments[0]},arguments[1])),(t=o.merge(n,{method:"get"},this.defaults,t)).method=t.method.toLowerCase();var e=[i,void 0],r=Promise.resolve(t);for(this.interceptors.request.forEach((function(t){e.unshift(t.fulfilled,t.rejected)})),this.interceptors.response.forEach((function(t){e.push(t.fulfilled,t.rejected)}));e.length;)r=r.then(e.shift(),e.shift());return r},o.forEach(["delete","get","head","options"],(function(t){s.prototype[t]=function(e,r){return this.request(o.merge(r||{},{method:t,url:e}))}})),o.forEach(["post","put","patch"],(function(t){s.prototype[t]=function(e,r,n){return this.request(o.merge(n||{},{method:t,url:e,data:r}))}})),t.exports=s},function(t,e){var r,n,o=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(t){r=a}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(t){n=i}}();var l,c=[],u=!1,d=-1;function h(){u&&l&&(u=!1,l.length?c=l.concat(c):d=-1,c.length&&p())}function p(){if(!u){var t=s(h);u=!0;for(var e=c.length;e;){for(l=c,c=[];++d<e;)l&&l[d].run();d=-1,e=c.length}l=null,u=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function y(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new f(t,e)),1!==c.length||u||s(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=y,o.addListener=y,o.once=y,o.off=y,o.removeListener=y,o.removeAllListeners=y,o.emit=y,o.prependListener=y,o.prependOnceListener=y,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(t,e,r){"use strict";var n=r(9);t.exports=function(t,e){n.forEach(t,(function(r,n){n!==e&&n.toUpperCase()===e.toUpperCase()&&(t[e]=r,delete t[n])}))}},function(t,e,r){"use strict";var n=r(16);t.exports=function(t,e,r){var o=r.config.validateStatus;r.status&&o&&!o(r.status)?e(n("Request failed with status code "+r.status,r.config,null,r.request,r)):t(r)}},function(t,e,r){"use strict";t.exports=function(t,e,r,n,o){return t.config=e,r&&(t.code=r),t.request=n,t.response=o,t}},function(t,e,r){"use strict";var n=r(9);function o(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function(t,e,r){if(!e)return t;var a;if(r)a=r(e);else if(n.isURLSearchParams(e))a=e.toString();else{var i=[];n.forEach(e,(function(t,e){null!=t&&(n.isArray(t)?e+="[]":t=[t],n.forEach(t,(function(t){n.isDate(t)?t=t.toISOString():n.isObject(t)&&(t=JSON.stringify(t)),i.push(o(e)+"="+o(t))})))})),a=i.join("&")}return a&&(t+=(-1===t.indexOf("?")?"?":"&")+a),t}},function(t,e,r){"use strict";var n=r(9),o=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function(t){var e,r,a,i={};return t?(n.forEach(t.split("\n"),(function(t){if(a=t.indexOf(":"),e=n.trim(t.substr(0,a)).toLowerCase(),r=n.trim(t.substr(a+1)),e){if(i[e]&&o.indexOf(e)>=0)return;i[e]="set-cookie"===e?(i[e]?i[e]:[]).concat([r]):i[e]?i[e]+", "+r:r}})),i):i}},function(t,e,r){"use strict";var n=r(9);t.exports=n.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function o(t){var n=t;return e&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return t=o(window.location.href),function(e){var r=n.isString(e)?o(e):e;return r.protocol===t.protocol&&r.host===t.host}}():function(){return!0}},function(t,e,r){"use strict";var n=r(9);t.exports=n.isStandardBrowserEnv()?{write:function(t,e,r,o,a,i){var s=[];s.push(t+"="+encodeURIComponent(e)),n.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),n.isString(o)&&s.push("path="+o),n.isString(a)&&s.push("domain="+a),!0===i&&s.push("secure"),document.cookie=s.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(t,e,r){"use strict";var n=r(9);function o(){this.handlers=[]}o.prototype.use=function(t,e){return this.handlers.push({fulfilled:t,rejected:e}),this.handlers.length-1},o.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},o.prototype.forEach=function(t){n.forEach(this.handlers,(function(e){null!==e&&t(e)}))},t.exports=o},function(t,e,r){"use strict";var n=r(9),o=r(36),a=r(17),i=r(12),s=r(37),l=r(38);function c(t){t.cancelToken&&t.cancelToken.throwIfRequested()}t.exports=function(t){return c(t),t.baseURL&&!s(t.url)&&(t.url=l(t.baseURL,t.url)),t.headers=t.headers||{},t.data=o(t.data,t.headers,t.transformRequest),t.headers=n.merge(t.headers.common||{},t.headers[t.method]||{},t.headers||{}),n.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete t.headers[e]})),(t.adapter||i.adapter)(t).then((function(e){return c(t),e.data=o(e.data,e.headers,t.transformResponse),e}),(function(e){return a(e)||(c(t),e&&e.response&&(e.response.data=o(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)}))}},function(t,e,r){"use strict";var n=r(9);t.exports=function(t,e,r){return n.forEach(r,(function(r){t=r(t,e)})),t}},function(t,e,r){"use strict";t.exports=function(t){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t)}},function(t,e,r){"use strict";t.exports=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}},function(t,e,r){"use strict";var n=r(18);function o(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise((function(t){e=t}));var r=this;t((function(t){r.reason||(r.reason=new n(t),e(r.reason))}))}o.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},o.source=function(){var t;return{token:new o((function(e){t=e})),cancel:t}},t.exports=o},function(t,e,r){"use strict";t.exports=function(t){return function(e){return t.apply(null,e)}}},function(t,e){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(e){return"function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?t.exports=n=function(t){return r(t)}:t.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":r(t)},n(e)}t.exports=n},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e){function r(e,n){return t.exports=r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},r(e,n)}t.exports=r},function(t,e,r){"use strict";const n=(t,{depth:e=1/0}={})=>e>0?t.reduce((t,r)=>t.concat(Array.isArray(r)?n(r,{depth:e-1}):[r]),[]):t;t.exports=r(19)(n)},function(t,e){t.exports=function(t,e,r,n){var o,a;if("boolean"!=typeof arguments[0]&&(n=r,r=e,e=t,t=!1),!Array.isArray(e))throw new TypeError("must be an array");if(e=t?e:e.slice(0),a=r<0?"unshift":"push",o=Math.abs(r),"number"!=typeof r||o%1!=0)throw new TypeError("length must be an integer");for(;e.length<o;)e[a](n);return e}},function(t,e,r){"use strict";t.exports=function(t,{blacklist:e}={}){const r=typeof t;return"function"===r?t:"undefined"===r?e?t=>!t:t=>!!t:Array.isArray(t)?e=>t.includes(e):e=>e===t}},function(t,e,r){"use strict";(function(e){const r=void 0!==e,n="undefined"!=typeof window;t.exports=t=>r&&t===e||n&&t===window}).call(this,r(13))},function(t,e,r){"use strict";t.exports=function(t){return null==t}},function(t,e,r){"use strict";t.exports=function(t){return"object"==typeof t&&null!==t}},function(t,e,r){"use strict";const n=r(51),o=r(20);t.exports=function(t,e){if(!Array.isArray(t))throw new TypeError("ofn argument 1 must be an array");if(n(t))throw new Error("ofn argument 1 array cannot have duplicates");if(t.some(t=>!Number.isInteger(t)))throw new TypeError("ofn argument 1 array must contain only numbers");if(t.some(e=>e<0||e>=t.length))throw new RangeError("ofn argument 1 array has a number out of range");if("function"!=typeof e)throw new TypeError("ofn argument 2 must be a function");return o(e,(function(){const r=[],n=t.slice(0,arguments.length).sort();for(let t=0;t<arguments.length;t++)r[t<n.length?n[t]:t]=arguments[t];return e.apply(this,r)}))}},function(t,e,r){"use strict";t.exports=function(t){return new Set(t).size<t.length}},function(t,e,r){"use strict";t.exports=function(t,e={},{enumOnly:r,overwrite:n=!0}={}){for(const o of(r?Object.keys:Reflect.ownKeys)(t))!n&&Object.prototype.hasOwnProperty.call(e,o)||Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o));return e}},function(t,e){t.exports=function(t,e,r){if(!Array.isArray(e)||!t.toString)throw new TypeError;t=t.toString(),r=void 0===r||!!r;var n=e.length;if(0===n)throw new Error("Cannot create an English list of an empty array");if(1===n)return e[0].toString();if(2===n)return e[0].toString()+" "+t+" "+e[1].toString();var o=e.map((function(t){return t.toString()})),a=o.slice(0,n-1),i=o[n-1];return a.join(", ")+(r?", ":" ")+t+" "+i}},function(t,e,r){"use strict";t.exports=(t,e,r)=>1==+t?e:r},function(t,e,r){"use strict";const n=r(56);t.exports=(t,e)=>n(e)?e:void 0===e?{}:{[t]:e}},function(t,e,r){"use strict";
/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var n=r(57);function o(t){return!0===n(t)&&"[object Object]"===Object.prototype.toString.call(t)}t.exports=function(t){var e,r;return!1!==o(t)&&("function"==typeof(e=t.constructor)&&(!1!==o(r=e.prototype)&&!1!==r.hasOwnProperty("isPrototypeOf")))}},function(t,e,r){"use strict";
/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */t.exports=function(t){return null!=t&&"object"==typeof t&&!1===Array.isArray(t)}},function(t,e,r){"use strict";const n=r(59);function o(t){const e=t.split("."),r=[];for(let t=0;t<e.length;t++){let n=e[t];for(;"\\"===n[n.length-1]&&void 0!==e[t+1];)n=n.slice(0,-1)+".",n+=e[++t];r.push(n)}return r}t.exports={get(t,e,r){if(!n(t)||"string"!=typeof e)return void 0===r?t:r;const a=o(e);for(let e=0;e<a.length;e++){if(!Object.prototype.propertyIsEnumerable.call(t,a[e]))return r;if(null==(t=t[a[e]])){if(e!==a.length-1)return r;break}}return t},set(t,e,r){if(!n(t)||"string"!=typeof e)return t;const a=t,i=o(e);for(let e=0;e<i.length;e++){const o=i[e];n(t[o])||(t[o]={}),e===i.length-1&&(t[o]=r),t=t[o]}return a},delete(t,e){if(!n(t)||"string"!=typeof e)return;const r=o(e);for(let e=0;e<r.length;e++){const o=r[e];if(e===r.length-1)return void delete t[o];if(t=t[o],!n(t))return}},has(t,e){if(!n(t)||"string"!=typeof e)return!1;const r=o(e);for(let e=0;e<r.length;e++){if(!n(t))return!1;if(!(r[e]in t))return!1;t=t[r[e]]}return!0}}},function(t,e,r){"use strict";t.exports=function(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}},function(t,e,r){"use strict";(function(e){
/**
 * filesize
 *
 * @copyright 2019 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 4.2.1
 */
!function(e){var r=/^(b|B)$/,n={iec:{bits:["b","Kib","Mib","Gib","Tib","Pib","Eib","Zib","Yib"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["b","Kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},o={iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]};function a(t){var e,a,i,s,l,c,u,d,h,p,f,y,v,m,g,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=[],x=0,k=void 0,C=void 0;if(isNaN(t))throw new TypeError("Invalid number");return a=!0===w.bits,f=!0===w.unix,e=w.base||2,p=void 0!==w.round?w.round:f?1:2,c=void 0!==w.locale?w.locale:"",u=w.localeOptions||{},y=void 0!==w.separator?w.separator:"",v=void 0!==w.spacer?w.spacer:f?"":" ",g=w.symbols||{},m=2===e&&w.standard||"jedec",h=w.output||"string",s=!0===w.fullform,l=w.fullforms instanceof Array?w.fullforms:[],k=void 0!==w.exponent?w.exponent:-1,i=e>2?1e3:1024,(d=(C=Number(t))<0)&&(C=-C),(-1===k||isNaN(k))&&(k=Math.floor(Math.log(C)/Math.log(i)))<0&&(k=0),k>8&&(k=8),"exponent"===h?k:(0===C?(b[0]=0,b[1]=f?"":n[m][a?"bits":"bytes"][k]):(x=C/(2===e?Math.pow(2,10*k):Math.pow(1e3,k)),a&&(x*=8)>=i&&k<8&&(x/=i,k++),b[0]=Number(x.toFixed(k>0?p:0)),b[0]===i&&k<8&&void 0===w.exponent&&(b[0]=1,k++),b[1]=10===e&&1===k?a?"kb":"kB":n[m][a?"bits":"bytes"][k],f&&(b[1]="jedec"===m?b[1].charAt(0):k>0?b[1].replace(/B$/,""):b[1],r.test(b[1])&&(b[0]=Math.floor(b[0]),b[1]=""))),d&&(b[0]=-b[0]),b[1]=g[b[1]]||b[1],!0===c?b[0]=b[0].toLocaleString():c.length>0?b[0]=b[0].toLocaleString(c,u):y.length>0&&(b[0]=b[0].toString().replace(".",y)),"array"===h?b:(s&&(b[1]=l[k]?l[k]:o[m][k]+(a?"bit":"byte")+(1===b[0]?"":"s")),"object"===h?{value:b[0],symbol:b[1]}:b.join(v)))}a.partial=function(t){return function(e){return a(e,t)}},t.exports=a}("undefined"!=typeof window&&window)}).call(this,r(13))},function(t,e,r){var n=function(t){"use strict";var e,r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function l(t,e,r,n){var o=e&&e.prototype instanceof y?e:y,a=Object.create(o.prototype),i=new L(n||[]);return a._invoke=function(t,e,r){var n=u;return function(o,a){if(n===h)throw new Error("Generator is already running");if(n===p){if("throw"===o)throw a;return P()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var s=D(i,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===u)throw n=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=h;var l=c(t,e,r);if("normal"===l.type){if(n=r.done?p:d,l.arg===f)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n=p,r.method="throw",r.arg=l.arg)}}}(t,r,i),a}function c(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var u="suspendedStart",d="suspendedYield",h="executing",p="completed",f={};function y(){}function v(){}function m(){}var g={};g[a]=function(){return this};var w=Object.getPrototypeOf,b=w&&w(w(T([])));b&&b!==r&&n.call(b,a)&&(g=b);var x=m.prototype=y.prototype=Object.create(g);function k(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function C(t){var e;this._invoke=function(r,o){function a(){return new Promise((function(e,a){!function e(r,o,a,i){var s=c(t[r],t,o);if("throw"!==s.type){var l=s.arg,u=l.value;return u&&"object"==typeof u&&n.call(u,"__await")?Promise.resolve(u.__await).then((function(t){e("next",t,a,i)}),(function(t){e("throw",t,a,i)})):Promise.resolve(u).then((function(t){l.value=t,a(l)}),(function(t){return e("throw",t,a,i)}))}i(s.arg)}(r,o,e,a)}))}return e=e?e.then(a,a):a()}}function D(t,r){var n=t.iterator[r.method];if(n===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=e,D(t,r),"throw"===r.method))return f;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var o=c(n,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,f;var a=o.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,f):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function T(t){if(t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}return{next:P}}function P(){return{value:e,done:!0}}return v.prototype=x.constructor=m,m.constructor=v,m[s]=v.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,s in t||(t[s]="GeneratorFunction")),t.prototype=Object.create(x),t},t.awrap=function(t){return{__await:t}},k(C.prototype),C.prototype[i]=function(){return this},t.AsyncIterator=C,t.async=function(e,r,n,o){var a=new C(l(e,r,n,o));return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(x),x[s]="Generator",x[a]=function(){return this},x.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=T,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),O(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:T(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),f}},t}(t.exports);try{regeneratorRuntime=n}catch(t){Function("r","regeneratorRuntime = r")(n)}},function(t,e){var r,n;
/*!
	Wheelzoom 4.0.0
	license: MIT
	http://www.jacklmoore.com/wheelzoom
*/
window.wheelzoom=(r={zoom:.1,maxZoom:!1,initialZoom:1},n=function(t,e){if(t&&t.nodeName&&"IMG"===t.nodeName){var n,o,a,i,s,l,c,u,d={},h=function(e){t.removeEventListener("wheelzoom.destroy",h),t.removeEventListener("wheelzoom.reset",f),t.removeEventListener("load",w),t.removeEventListener("mouseup",m),t.removeEventListener("mousemove",v),t.removeEventListener("mousedown",g),t.removeEventListener("wheel",y),t.style.backgroundImage=e.backgroundImage,t.style.backgroundRepeat=e.backgroundRepeat,t.src=e.src}.bind(null,{backgroundImage:t.style.backgroundImage,backgroundRepeat:t.style.backgroundRepeat,src:t.src});t.addEventListener("wheelzoom.destroy",h),e=e||{},Object.keys(r).forEach((function(t){d[t]=void 0!==e[t]?e[t]:r[t]})),t.complete&&w(),t.addEventListener("load",w)}function p(){s>0?s=0:s<n-a&&(s=n-a),l>0?l=0:l<o-i&&(l=o-i),t.style.backgroundSize=a+"px "+i+"px",t.style.backgroundPosition=s+"px "+l+"px"}function f(){a=n,i=o,s=l=0,p()}function y(e){var r=0;e.preventDefault(),e.deltaY?r=e.deltaY:e.wheelDelta&&(r=-e.wheelDelta);var c=t.getBoundingClientRect(),u=e.pageX-c.left-window.pageXOffset,h=e.pageY-c.top-window.pageYOffset,y=(u-s)/a,v=(h-l)/i;r<0?(a+=a*d.zoom,i+=i*d.zoom):(a-=a*d.zoom,i-=i*d.zoom),d.maxZoom&&(a=Math.min(n*d.maxZoom,a),i=Math.min(o*d.maxZoom,i)),s=u-a*y,l=h-i*v,a<=n||i<=o?f():p()}function v(t){t.preventDefault(),t.stopPropagation(),s+=t.pageX-c.pageX,l+=t.pageY-c.pageY,c=t,p()}function m(t){t.stopPropagation(),t.preventDefault(),document.removeEventListener("mouseup",m),document.removeEventListener("mousemove",v)}function g(t){t.preventDefault(),c=t,document.addEventListener("mousemove",v),document.addEventListener("mouseup",m)}function w(){var e=Math.max(d.initialZoom,1);if(t.src!==u){var r=window.getComputedStyle(t,null);n=parseInt(r.width,10),o=parseInt(r.height,10),s=-((a=n*e)-n)/2,l=-((i=o*e)-o)/2,function(t){t.style.backgroundRepeat="no-repeat",t.style.backgroundImage='url("'+t.src+'")',u="data:image/svg+xml;base64,"+window.btoa('<svg xmlns="http://www.w3.org/2000/svg" width="'+t.naturalWidth+'" height="'+t.naturalHeight+'"></svg>'),t.src=u}(t),t.style.backgroundSize=a+"px "+i+"px",t.style.backgroundPosition=s+"px "+l+"px",t.addEventListener("wheelzoom.reset",f),t.addEventListener("wheel",y),t.addEventListener("mousedown",g)}}},"function"!=typeof window.btoa?function(t){return t}:function(t,e){return t&&t.length?Array.prototype.forEach.call(t,n,e):t&&t.nodeName&&n(t,e),t})},function(t,e){t.exports=function(t){if(Array.isArray(t))return t}},function(t,e){t.exports=function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(t,e,r){},function(t,e,r){"use strict";r.r(e);var n=r(1),o=r.n(n),a=r(2),i=r.n(a),s=r(0),l=r.n(s);function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e,r){var n=r.value;if("function"!=typeof n)throw new TypeError("@boundMethod decorator can only be applied to methods not: ".concat(c(n)));var o=!1;return{configurable:!0,get:function(){if(o||this===t.prototype||this.hasOwnProperty(e)||"function"!=typeof n)return n;var r=n.bind(this);return o=!0,Object.defineProperty(this,e,{configurable:!0,get:function(){return r},set:function(t){n=t,delete this[e]}}),o=!1,r},set:function(t){n=t}}}var d,h={serverUrl:"http://onc.danycabrera.com"},p=r(11),f=r.n(p);function y(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(t[e]||!1===t[e]){var n=t[e];return"true"==n||"false"!=n&&(isNaN(n)?t[e]:+n)}return r}function v(t,e){if(Array.isArray(e)||(e=[e]),t){for(var r=0;r<e.length;r++)if(!t[e[r]])return!1;return!0}return!1}var m=(d=function(){function t(e){o()(this,t),this.token=e,this.baseUrl="https://data.oceannetworks.ca/",this.useApiProxy=""==this.token,this._axios=f.a.create({method:"get",baseURL:this.baseUrl,timeout:12e4}),this.getLocations=this.getLocations.bind(this),this.getDevices=this.getDevices.bind(this),this.getDeviceCategories=this.getDeviceCategories.bind(this),this.getProperties=this.getProperties.bind(this),this.getDeployments=this.getDeployments.bind(this),this.getDataProducts=this.getDataProducts.bind(this)}return i()(t,[{key:"doRequest",value:function(t,e){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"api",o={params:e};if(this.useApiProxy||(o.params.token=this.token),""==n&&(o.url=t),"api"==n&&this.useApiProxy?o.url="apiproxy/".concat(t):o.url="".concat(n,"/").concat(t),"download"==e.method&&e.extension)switch(e.extension){case"txt":o.responseType="text";break;case"json":o.responseType="json";break;case"csv":o.responseType="text";break;default:o.responseType="blob"}return new Promise((function(t,e){r._axios.request(o).then((function(r){0===r.data.length&&e("empty"),t(r)}),(function(t){e(t)}))}))}},{key:"getUrlFromResponse",value:function(t){var e=t.request.responseURL;this.useProxy&&(e=t.config.headers["X-Proxy-Url"]+e.substr(this.proxyUrl.length));return e}},{key:"errorToString",value:function(t){var e=t.response,r="<b>Error:</b> ".concat(e.statusText,"<br><b>Code:</b> ").concat(e.status,"<br>");if(e.data&&e.data.errors){r+="<ul>";var n=!0,o=!1,a=void 0;try{for(var i,s=e.data.errors[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var l=i.value;l.parameter?r+="<li><b>".concat(l.errorMessage,"</b>: ").concat(l.parameter,"</li>"):r+="<li>".concat(l.errorMessage,"</li>")}}catch(t){o=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}r+="</ul>"}return r}},{key:"getLocations",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"get";return t.method=e,this.doRequest("locations",t)}},{key:"getDevices",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"get";return t.method=e,this.doRequest("devices",t)}},{key:"getDeployments",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"get";return t.method=e,this.doRequest("deployments",t)}},{key:"getDeviceCategories",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"get";return t.method=e,this.doRequest("deviceCategories",t)}},{key:"getProperties",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"get";return t.method=e,this.doRequest("properties",t)}},{key:"getDataProducts",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"get";return t.method=e,this.doRequest("dataProducts",t)}},{key:"productRequest",value:function(t){return t.method="request",this.doRequest("dataProductDelivery",t)}},{key:"productRun",value:function(t){return t.method="run",this.doRequest("dataProductDelivery",t)}},{key:"productStatus",value:function(t){return t.method="status",this.doRequest("dataProductDelivery",t)}},{key:"productDownload",value:function(t){return t.method="download",this.doRequest("dataProductDelivery",t)}},{key:"getProductDownloadURL",value:function(t,e){var r=this.useProxy?"":"&token=".concat(this.token),n=this.useProxy?"apiproxy":"api";return"".concat(this.baseUrl).concat(n,"/dataProductDelivery?method=download").concat(r,"&dpRunId=").concat(t,"&index=").concat(e)}},{key:"getScalarData",value:function(t){return t.method=t.deviceCode?"getByDevice":"getByLocation",this.doRequest("scalardata",t)}},{key:"getRawData",value:function(t){if(v(t,["locationCode","deviceCategoryCode"]))t.method="getByLocation";else{if(!v(t,"deviceCode"))throw Error("The rawdata service requires either deviceCode, or a compbiantion of locationCode and deviceCategoryCode.");t.method="getByDevice"}return this.doRequest("rawdata",t)}},{key:"getArchiveFileList",value:function(t){if(v(t,["locationCode","deviceCategoryCode"]))t.method="getListByLocation";else{if(!v(t,["deviceCode"]))throw Error("Filters should include either both <b>locationCode</b> and <b>deviceCategoryCode</b>, or <b>deviceCode</b>.");t.method="getListByDevice"}return this.doRequest("archivefiles",t)}},{key:"getScalarPlotting",value:function(t){return this.doRequest("ScalarDataAPIService",t,"")}}]),t}(),l()(d.prototype,"getLocations",[u],Object.getOwnPropertyDescriptor(d.prototype,"getLocations"),d.prototype),l()(d.prototype,"getDevices",[u],Object.getOwnPropertyDescriptor(d.prototype,"getDevices"),d.prototype),l()(d.prototype,"getDeployments",[u],Object.getOwnPropertyDescriptor(d.prototype,"getDeployments"),d.prototype),l()(d.prototype,"getDeviceCategories",[u],Object.getOwnPropertyDescriptor(d.prototype,"getDeviceCategories"),d.prototype),l()(d.prototype,"getProperties",[u],Object.getOwnPropertyDescriptor(d.prototype,"getProperties"),d.prototype),l()(d.prototype,"getDataProducts",[u],Object.getOwnPropertyDescriptor(d.prototype,"getDataProducts"),d.prototype),l()(d.prototype,"productRequest",[u],Object.getOwnPropertyDescriptor(d.prototype,"productRequest"),d.prototype),l()(d.prototype,"productRun",[u],Object.getOwnPropertyDescriptor(d.prototype,"productRun"),d.prototype),l()(d.prototype,"productStatus",[u],Object.getOwnPropertyDescriptor(d.prototype,"productStatus"),d.prototype),l()(d.prototype,"productDownload",[u],Object.getOwnPropertyDescriptor(d.prototype,"productDownload"),d.prototype),l()(d.prototype,"getProductDownloadURL",[u],Object.getOwnPropertyDescriptor(d.prototype,"getProductDownloadURL"),d.prototype),l()(d.prototype,"getScalarData",[u],Object.getOwnPropertyDescriptor(d.prototype,"getScalarData"),d.prototype),l()(d.prototype,"getRawData",[u],Object.getOwnPropertyDescriptor(d.prototype,"getRawData"),d.prototype),l()(d.prototype,"getArchiveFileList",[u],Object.getOwnPropertyDescriptor(d.prototype,"getArchiveFileList"),d.prototype),l()(d.prototype,"getScalarPlotting",[u],Object.getOwnPropertyDescriptor(d.prototype,"getScalarPlotting"),d.prototype),d),g=r(4),w=r.n(g),b=r(5),x=r.n(b),k=r(6),C=r.n(k),D=r(3),S=r.n(D),O=r(8),L=r.n(O);function T(t){return!isNaN(parseFloat(t))&&isFinite(t)}S.a.extend(L.a);var P=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];o()(this,t),""==e&&(e=_("now")),this.text=e,this.utc=r,this.isRelative=!1,this.offset={operation:"",unit:"",quantity:0},this.parsedString="",this._unitNames=["y","M","w","d","h","m","s"];try{this.parsedString=this.parse(e)}catch(t){throw t}}return i()(t,[{key:"parse",value:function(t){try{if(""==t)throw new Error("Tried to parse an empty date string.");var e=t.length;if(this.isValidISO8601(t))return t;var r=_(t,this.utc);if(""!=r)return r;if(function(t){return S()(t).isValid()}(t))return function(t){return S()(t).format("YYYY-MM-DDTHH:mm:ss.SSS")+"Z"}(t);this.isRelative=!0;var n=t.charAt(e-1);if(!this.isValidUnit(n))throw new Error('Unrecognized date format: "'.concat(t,'"'));var o="";if("last"==t.substr(0,4))o="last";else if("plus"==t.substr(0,4))o="plus";else{if("minus"!=t.substr(0,5))throw new Error('Unrecognized date format: "'.concat(t,'"'));o="minus"}var a=t.substring(o.length,e-1);if(!T(a))throw new Error('Unrecognized date format: "'.concat(t,'"'));this.offset={operation:o,unit:n,quantity:parseInt(a,10)}}catch(t){throw t}return""}},{key:"isValidUnit",value:function(t){return this._unitNames.indexOf(t)>-1}},{key:"isValidISO8601",value:function(t){return/\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)/.test(t)}},{key:"offsetFrom",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this.isRelative)return this.toString();var e,r=t?S.a.utc(t.toString()):S.a.utc(),n=this.offset;return"last"==n.operation?e=r.subtract(n.quantity,n.unit):"plus"==n.operation?e=r.add(n.quantity,n.unit):"minus"==n.operation&&(e=r.subtract(n.quantity,n.unit)),e.format("YYYY-MM-DDTHH:mm:ss.SSS")+"Z"}},{key:"toString",value:function(){return this.parsedString}}]),t}();function M(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=null,o=null,a=null,i=null;try{n=t?new P(t,r):null,o=e?new P(e,r):null}catch(t){throw t}return n&&(a=n.offsetFrom(o)),o&&(i=o.offsetFrom(n)),{dateFrom:a,dateTo:i}}function E(t){if(t<1)return"".concat(t," seconds");var e=parseInt(t,10),r=Math.floor(e/3600),n=Math.floor((e-3600*r)/60),o=e-3600*r-60*n,a="";return r>0&&(a+="".concat(r," hours ")),n>0&&(a+="".concat(n," minutes ")),o>0&&(a+="".concat(o," seconds")),a}function _(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(t){case"now":return function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?S.a.format("YYYY-MM-DDTHH:mm:ss.SSS")+"Z":S.a.utc().format("YYYY-MM-DDTHH:mm:ss.SSS")+"Z"}(e);case"today":return function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=F(S()());return t||(e=e.utc()),e.format("YYYY-MM-DDTHH:mm:ss.SSS")+"Z"}(e);case"yesterday":return function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=F(S()().subtract(1,"days"));return t||(e=e.utc()),e.format("YYYY-MM-DDTHH:mm:ss.SSS")+"Z"}(e)}return""}function R(t,e){return S()(t).utc().format(e)}function F(t){return t=(t=(t=(t=t.set("hour",0)).set("minute",0)).set("second",0)).set("millisecond",0)}S.a.extend(L.a);var j=r(10),A=r.n(j);var I,N=function(){function t(){o()(this,t),this.userDates={dateFrom:null,dateTo:null},this.parsedDates={dateFrom:null,dateTo:null},this.warnings=[],this.errors=[]}return i()(t,[{key:"parse",value:function(t){var e=this.gatherTagAttributes(t);e.filters={},console.log(e);var r=t.closest(".oncWidgetGroup");if(r){var n=this.gatherTagAttributes(r);for(var o in""==e.type&&""!=n.type&&(e.type=n.type),""==e.source&&""!=n.source&&["plot"].includes(e.type)&&(e.source=n.source),n.attributes)e.attributes[o]||(e.attributes[o]=n.attributes[o]);for(var a in n.engine)e.engine[a]||(e.engine[a]=n.engine[a]);for(var i in n.options)e.options[i]||(e.options[i]=n.options[i])}if(""==e.type)return this.fatal("No <b>data-widget</b> attribute found in this data widget.");""==e.source&&(e.source=this.sourceForType(e.type,e));var s=function(t,e){switch(t){case"plottingUtility":return{sensorId:null,x:null,y:null,deviceId:null,dateFrom:void 0,dateTo:_("now"),points:300};case"quickPlot":return{sensorId:void 0,dateFrom:void 0,dateTo:_("now"),plotTitle:"off"};case"json":return{path:void 0,x:null,y:null};case"scalardata":return{locationCode:void 0,deviceCategoryCode:void 0,deviceCode:null,propertyCode:null,sensorCategoryCodes:null,dateFrom:null,dateTo:null,x:null,y:null};case"rawdata":return{locationCode:null,deviceCategoryCode:null,deviceCode:null,rowLimit:null,sizeLimit:null,convertHexToDecimal:null,outputFormat:"object",getLatest:null,returnOptions:null,dateFrom:null,dateTo:null,x:null,y:null};case"dataPreview":return{url:void 0,range:null};case"dataProductDelivery":var r={dataProductCode:void 0,extension:void 0,dateFrom:_("today"),dateTo:_("now"),dataProductName:null,locationCode:null,deviceCategoryCode:null,deviceCode:null,propertyCode:null,dpo_qualityControl:null,dpo_resample:null,dpo_average:null,dpo_sensorstoinclude:null,dpo_3beam:null,dpo_corScreen:null,dpo_errVelScreen:null,dpo_falseTarScreen:null,dpo_horizontalcurrentplotlimits:null,dpo_velocityBinmapping:null,dpo_verticalcurrentplotlimits:null,x:null,y:null};switch(e){case"plot":r.dataProductCode="TSSD",r.extension="json",r.dpo_jsonOutputEncoding="OM",r.dpo_dataGaps="0";break;case"image":r.dataProductCode="TSSP",r.extension="png";break;case"download":r.dpo_dataGaps="1"}return r;case"discovery":switch(e){case"locations":return{sensorId:null,locationCode:null,deviceCategoryCode:null,deviceCode:null,propertyCode:null,dataProductCode:null,dateFrom:null,dateTo:null,locationName:null};case"deployments":return{sensorId:null,locationCode:null,deviceCategoryCode:null,deviceCode:null,propertyCode:null,dateFrom:null,dateTo:null};case"deviceCategories":return{sensorId:null,locationCode:null,deviceCategoryCode:null,deviceCategoryName:null,propertyCode:null};case"devices":return{locationCode:null,deviceCategoryCode:null,deviceCode:null,deviceName:null,deviceId:null,propertyCode:null,dataProductCode:null,dateFrom:null,dateTo:null,locationName:null};case"properties":return{sensorId:null,locationCode:null,deviceCategoryCode:null,deviceCode:null,propertyCode:null,propertyName:null,description:null};case"dataProducts":return{sensorId:null,dataProductCode:null,extension:null,dataProductName:null,locationCode:null,deviceCategoryCode:null,deviceCode:null,propertyCode:null}}}return"archivefiles"==t?{locationCode:null,deviceCategoryCode:null,deviceCode:null,dateFrom:null,dateTo:null,dateArchivedFrom:null,dateArchivedTo:null,returnOptions:null,rowLimit:null,page:null,getLatest:null,extension:null}:{}}(e.source,e.type);this.copyIfExists(e.attributes,e.filters,Object.keys(s)),e.filters.dateFrom&&!e.filters.dateTo&&(e.filters.dateTo="now"),this.userDates.dateFrom=e.filters.dateFrom,this.userDates.dateTo=e.filters.dateTo;try{var l=!!e.options.utc&&e.options.utc;this.parsedDates=M(e.filters.dateFrom,e.filters.dateTo,l);var c=this.parsedDates;c.dateFrom&&(e.filters.dateFrom=c.dateFrom),c.dateTo&&(e.filters.dateTo=c.dateTo)}catch(t){return this.fatal(t)}for(var u in s)null==e.filters[u]&&null!==s[u]&&(e.filters[u]=s[u]);return this.validateFilters(e.filters,s,e.options),e}},{key:"gatherTagAttributes",value:function(t){for(var e,r,n={type:"",source:"",title:"",attributes:{},options:{},engine:{}},o=["class","id","lang","style","tabindex","align","accesskey","contenteditable","dir","draggable","dropzone","translate","hidden"],a=t.dataset,i=t.attributes,s={},l=0;l<i.length;l++)e=i[l].name,""!=(r=i[l].value)&&"data-"!=e.substr(0,5)&&-1==o.indexOf(e)&&(s[e]=r);for(var c in a)""!=a[c]&&(s[c]=a[c]);for(var u in s)"widget"==u?n.type=s.widget:"source"==u?n.source=s.source:"title"==u?n.title=s.title:"engine"==u?n.engine=this.parseOptionsString(s.engine):"options"==u?n.options=this.parseOptionsString(s.options):"addons"==u?n.addons=this.parseAddonsString(s.addons):n.attributes[u]=s[u];return n}},{key:"validateFilters",value:function(t,e,r){var n=["widget","options","source"];for(var o in e)n.push(o),void 0===e[o]&&(t[o]||this.errors.push("Widget tag is missing a mandatory filter: <b>".concat(o,"</b>")))}},{key:"copyIfExists",value:function(t,e,r){var n,o;for(n=0;n<r.length;n++)t[o=r[n].toLowerCase()]&&(e[r[n]]=t[o])}},{key:"parseOptionsString",value:function(t){try{var e,r,n,o={},a=t.split(","),i=!0,s=!1,l=void 0;try{for(var c,u=a[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var d=c.value;if(2!=(e=d.split(":")).length)throw new Error('Illegal syntax near "'.concat(d,'"'));switch(r=e[0].trim(),n=e[1].trim()){case"true":o[r]=!0;break;case"false":o[r]=!1;break;default:o[r]=n}}}catch(t){s=!0,l=t}finally{try{i||null==u.return||u.return()}finally{if(s)throw l}}return o}catch(t){throw new Error("Check that special configuration attributes (engine, options) have the right format.<br>".concat(t.name,": ").concat(t.message,"."))}}},{key:"parseAddonsString",value:function(t){var e=[],r=t.split(","),n=!0,o=!1,a=void 0;try{for(var i,s=r[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var l=i.value;e.push(l.trim())}}catch(t){o=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return e}},{key:"fatal",value:function(t){return this.errors.push(t),!1}},{key:"sourceForType",value:function(t,e){if(["locations","deployments","deviceCategories","devices","properties","dataProducts"].includes(t))return"discovery";if(["download","image"].includes(t))return"dataProductDelivery";return["archiveFiles","archiveGif","archiveDays","archiveMap"].includes(t)?"archivefiles":"plot"==t?e.attributes.sensorid?"plottingUtility":"scalardata":t==rawValue?"rawdata":""}}]),t}(),q=function(){function t(e,r){o()(this,t),this.domNode=e,this.cbkCancel=r}return i()(t,[{key:"showMessage",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n="";switch(t){case"api_error":n="Oceans 2.0 API error";break;case"error":n="Widget error";break;case"info":n="Information"}this.renderStatusBox(t,n,e,r),this.cbkCancel()}},{key:"showLoader",value:function(t,e){this.renderSpinner(t,e)}},{key:"renderStatusBox",value:function(t,e,r,n){if(n){var o="";for(var a in n)o+="<li><b>".concat(a,"</b><span>").concat(n[a],"</span></li>\n");'<div class="request">\n\t\t\t\t\t\t\t\t<a href="#none">[+] Show request info</a>\n\t\t\t\t\t\t\t\t<div class="info"><ul>'.concat(o,"</ul></div>\n\t\t\t\t\t\t\t</div>")}this.domNode.innerHTML='\n\t\t<div class="statusMsg '.concat(t,'">\n\t\t\t<div class="header">').concat(e,'</div>\n\t\t\t<div class="message">\n\t\t\t\t').concat(r,"\n\t\t\t\t\n\t\t\t</div>\n\t\t</div>")}},{key:"renderSpinner",value:function(t,e){this.domNode.innerHTML='<div class="statusMsg '.concat(t,'">').concat('<div class="spinner la-line-scale-pulse-out"><div></div><div></div><div></div><div></div><div></div></div>','<div class="spinnerText">').concat(e,"</div></div>");var r=document.createElement("span");r.innerHTML="Cancel",r.classList.add("cancel"),r.addEventListener("click",this.cbkCancel),this.domNode.childNodes[0].appendChild(r)}},{key:"remove",value:function(){var t=this.domNode.querySelector("div.statusMsg");t&&t.parentNode.removeChild(t)}}]),t}(),U=(I=function(){function t(e){o()(this,t),this.widget=e,this.items=[],this.dom={base:null,button:null,ul:null}}return i()(t,[{key:"addItem",value:function(t,e,r){this.items.push({code:t,label:e,callback:r})}},{key:"hasItem",value:function(t){for(var e in items)if(e.code==t)return!0;return!1}},{key:"toggle",value:function(t){t.stopPropagation(),this.dom.base.classList.toggle("active")}},{key:"hide",value:function(){this.dom.base&&this.dom.base.classList.remove("active")}},{key:"render",value:function(){var t=this,e=document.createElement("div");e.classList.add("menu");var r=document.createElement("button");e.appendChild(r);var n=document.createElement("ul"),o=!0,a=!1,i=void 0;try{for(var s,l=this.items[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var c=s.value,u=document.createElement("li"),d=document.createElement("a");d.setAttribute("href","javascript:void(0)"),d.innerHTML=c.label,d.addEventListener("click",c.callback),d.addEventListener("click",(function(e){t.hide()})),u.appendChild(d),n.appendChild(u)}}catch(t){a=!0,i=t}finally{try{o||null==l.return||l.return()}finally{if(a)throw i}}return e.appendChild(n),r.addEventListener("click",this.toggle),this.dom.button=r,this.dom.ul=n,this.dom.base=e,e}}]),t}(),l()(I.prototype,"toggle",[u],Object.getOwnPropertyDescriptor(I.prototype,"toggle"),I.prototype),l()(I.prototype,"hide",[u],Object.getOwnPropertyDescriptor(I.prototype,"hide"),I.prototype),l()(I.prototype,"render",[u],Object.getOwnPropertyDescriptor(I.prototype,"render"),I.prototype),I);function $(t,e){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n="",o=""!=r?r.split(","):[],a=t.length,i=o.length,s=0;s<a;s++)n+=i>0&&i>s?"<".concat(e,' class="').concat(o[s],'">').concat(t[s],"</").concat(e,">"):"<".concat(e,">").concat(t[s],"</").concat(e,">");return n}function H(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n='<table class="oncTable '.concat(r,'">');return n+="<thead>"+$(t,"th")+"</thead>",n+="<tbody>"+e+"</tbody></table>"}function Y(t){var e=document.createElement("button");return e.type="button",e.title="Show children",e.innerHTML="&plus;",e.locationCode=t,e.onclick=function(t){var e=t.target.locationCode;document.querySelectorAll('tr[data-parent="'.concat(e,'"]')).forEach((function(t){t.classList.toggle("show")}))},e}var B,z=r(60);function W(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",r=t.split(e);if(r){for(var n in r)r[n]=r[n].trim();return r}return[t.trim()]}function V(t){return z(t)}function Z(t){return t.substr(t.lastIndexOf(".")+1)}var X,G,K,J,Q=(B=function(){function t(e){o()(this,t),this.label="Show report",this.widget=e,this.visible=!1,this.domNode=null}return i()(t,[{key:"preRender",value:function(){this.domNode=document.createElement("div"),this.domNode.classList.add("report"),this.widget.dom.footer.appendChild(this.domNode)}},{key:"render",value:function(){var t=this.widget,e=this.widget.ds?this.widget.ds.performance:null,r="",n="(no data)",o="(no data)";if(e&&(n=e.downloadTime,o=V(e.downloadSize)),t.options.showWarnings&&t.warnings.length>0){var a=$(t.warnings,"li"),i=$(t.ds.warnings,"li");r+='<div class="warnings"><ul>'.concat(a).concat(i,"</ul></div>")}if(r+="<h2>Widget report (".concat(t.type,")</h2>"),r+="<p><b>Status:</b> ".concat(t.status,"</p>"),Object.keys(t.filters).length>0){var s="";for(var l in t.filters)s+="<tr><td>".concat(l,"</td><td>").concat(t.filters[l],"</td></tr>");r+="<h3>Request parameters:</h3>"+H(["Key","Value"],s,"requestInfo")}else r+="<p>No request parameters interpreted.</p>";var c=["<b>Duration:</b> ".concat(n),"<b>Payload size:</b> ".concat(o)];if(t.ds){if(r+="<h3>Performance:</h3><ul>"+$(c=c.concat(e.messages),"li")+"</ul>",t.ds.requestURLs.length>0){var u="",d=!0,h=!1,p=void 0;try{for(var f,y=t.ds.requestURLs[Symbol.iterator]();!(d=(f=y.next()).done);d=!0){var v=f.value;u+='<li><a href="'.concat(v,'" target="_blank">').concat(v,"</a></li>")}}catch(t){h=!0,p=t}finally{try{d||null==y.return||y.return()}finally{if(h)throw p}}r+='<div class="requests"><h3>Request URLs:</h3><ol>'.concat(u,"</ol></div>")}}else r+="<p>No performance information available.</p>";r+="</div>",this.domNode.innerHTML=r}},{key:"toggle",value:function(){this.visible=!this.visible,this.visible&&this.render(),this.domNode.classList.toggle("active")}},{key:"hide",value:function(){this.visible&&(this.visible=!1,this.domNode.classList.remove("active"))}}]),t}(),l()(B.prototype,"render",[u],Object.getOwnPropertyDescriptor(B.prototype,"render"),B.prototype),l()(B.prototype,"toggle",[u],Object.getOwnPropertyDescriptor(B.prototype,"toggle"),B.prototype),l()(B.prototype,"hide",[u],Object.getOwnPropertyDescriptor(B.prototype,"hide"),B.prototype),B),tt=(X=function(){function t(e){o()(this,t),this.label="Download CSV",this.widget=e}return i()(t,[{key:"download",value:function(){this.widget.ds.saveDataToFile()}}]),t}(),l()(X.prototype,"download",[u],Object.getOwnPropertyDescriptor(X.prototype,"download"),X.prototype),X),et=(G=function(){function t(e){o()(this,t),this.label="View in plotting utility",this.sensorId=e.sensorId,this.dateFrom=e.dateFrom,this.dateTo=e.dateTo}return i()(t,[{key:"open",value:function(){var t=this.sensorId,e=S()(this.dateFrom),r=S()(this.dateTo),n=e.format("DD-MMM-YYYY%20HH:mm:ss"),o=r.format("DD-MMM-YYYY%20HH:mm:ss"),a="https://data.oceannetworks.ca/PlottingUtility?TREETYPE=26&SENSOR=".concat(t,"&DATEFROM=").concat(n,"&DATETO=").concat(o);window.open(a,"_blank")}}]),t}(),l()(G.prototype,"open",[u],Object.getOwnPropertyDescriptor(G.prototype,"open"),G.prototype),G),rt=r(7),nt=r.n(rt),ot=r(21),at=(K=function(){function t(e){o()(this,t),A()(t,this,"download"),this.name=e,this.data=null,this.cancelFlag=!1,this.performance={downloadStart:null,downloadEnd:null,downloadTime:"",downloadSize:0,messages:[]},this.userDates={dateFrom:null,dateTo:null},this.requestURLs=[],this.warnings=[]}return i()(t,[{key:"logDownloadStart",value:function(){this.performance.downloadStart=S()()}},{key:"logDownloadEnd",value:function(){this.performance.downloadEnd=S()();var t=this.performance.downloadEnd.diff(this.performance.downloadStart,"second");this.performance.downloadTime=E(t)}},{key:"saveDataToFile",value:function(){for(var t,e=this.data.length,r=this.data[0].samples.values.length,n=this.data[0].samples.min,o="SampleTime",a=0;a<e;a++)o+=","+(t=this.data[a].sensorName),n&&(o+=" (AVG), ".concat(t," (MIN), ").concat(t," (MAX), ").concat(t," QAQC"));for(var i=0;i<r;i++){o+="\n"+this.data[0].samples.times[i];for(var s=0;s<e;s++)o+=","+this.data[s].samples.values[i],n&&(o+=","+this.data[s].samples.min[i],o+=","+this.data[s].samples.max[i]),o+=","+this.data[s].samples.qaqc[i]}var l=new Blob([o],{type:"text/plain;charset=utf-8"}),c=new Date;Object(ot.saveAs)(l,"".concat(c.getTime(),".csv"))}},{key:"addRequestURL",value:function(t){this.requestURLs.push(t)}},{key:"addPerformanceMsg",value:function(t){this.performance.messages.push(t)}},{key:"addWarning",value:function(t){this.warnings.push("<b>Warning:</b> "+t)}},{key:"refreshDateRangeFilters",value:function(){if(this.filters){var t=M(this.userDates.dateFrom,this.userDates.dateTo);t.dateFrom&&(this.filters.dateFrom=t.dateFrom),t.dateTo&&(this.filters.dateTo=t.dateTo)}}},{key:"hasData",value:function(){return void 0!==this.data&&null!==this.data&&0!=this.data.length&&this.data.length>0}},{key:"cancel",value:function(){this.cancelFlag=!0}},{key:"clear",value:function(){this.data=null}}]),t}(),l()(K.prototype,"saveDataToFile",[u],Object.getOwnPropertyDescriptor(K.prototype,"saveDataToFile"),K.prototype),l()(K.prototype,"refreshDateRangeFilters",[u],Object.getOwnPropertyDescriptor(K.prototype,"refreshDateRangeFilters"),K.prototype),K);S.a.extend(L.a);var it,st,lt,ct=(J=function(t){function e(t,r,n){var a;return o()(this,e),(a=w()(this,x()(e).call(this,"plottingUtility")))._onc=t,a.filters=r,a.points=a.filters.points,a.sensorIds=[],a.isClean=!0,a.mode="MinMaxAvg",a.initSensorIds(),a.cbkShowLoader=n,a}return C()(e,t),i()(e,[{key:"initSensorIds",value:function(){var t=this.filters;if(!t.sensorId&&!t.x&&!t.y)throw new Error("This data source requires either the <b>sensorId</b> parameter, or both <b>x</b> and <b>y</b> parameters.");if(-1!=t.sensorId.indexOf(",")){var e=t.sensorId.split(","),r=!0,n=!1,o=void 0;try{for(var a,i=e[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value;this.sensorIds.push(s.trim())}}catch(t){n=!0,o=t}finally{try{r||null==i.return||i.return()}finally{if(n)throw o}}}else t.sensorId&&this.sensorIds.push(t.sensorId.trim())}},{key:"download",value:function(){var t,e=this;return nt.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return this.data=[],t={datefrom:S.a.utc(this.filters.dateFrom).format("DD-MMM-YYYY HH:mm:ss"),dateto:S.a.utc(this.filters.dateTo).format("DD-MMM-YYYY HH:mm:ss"),option:this.optionCode(this.mode),isClean:this.isClean,plotpoints:this.filters.points},r.abrupt("return",new Promise((function(r,n){var o,a,i,s,l,c,u,d;return nt.a.async((function(h){for(;;)switch(h.prev=h.next){case 0:e.logDownloadStart(),e.cbkShowLoader("loading","Loading plot data"),o=0,a=!0,i=!1,s=void 0,h.prev=6,l=e.sensorIds[Symbol.iterator]();case 8:if(a=(c=l.next()).done){h.next=24;break}return u=c.value,h.prev=10,h.next=13,nt.a.awrap(e.downloadSensor(u,t));case 13:d=h.sent,o+=d.request.responseText.length,h.next=21;break;case 17:return h.prev=17,h.t0=h.catch(10),n(h.t0),h.abrupt("return");case 21:a=!0,h.next=8;break;case 24:h.next=30;break;case 26:h.prev=26,h.t1=h.catch(6),i=!0,s=h.t1;case 30:h.prev=30,h.prev=31,a||null==l.return||l.return();case 33:if(h.prev=33,!i){h.next=36;break}throw s;case 36:return h.finish(33);case 37:return h.finish(30);case 38:e.logDownloadEnd(),e.performance.downloadSize=o,e.cbkShowLoader("hide"),r(e.data);case 42:case"end":return h.stop()}}),null,null,[[6,26,30,38],[10,17],[31,,33,37]])})));case 3:case"end":return r.stop()}}),null,this)}},{key:"reload",value:function(t,e){var r=this;return new Promise((function(t,e){var n=parseInt(r.filters.points,10);r.filters.points=n+500,r.download().then((function(e){t(e)}))}))}},{key:"downloadSensor",value:function(t,e){var r=this;return nt.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return e.sensorid=t,n.abrupt("return",new Promise((function(n,o){r.cbkShowLoader("loading","Downloading sensor ".concat(t)),r._onc.getScalarPlotting(e).then((function(e){if(r.requestURLs.push(r._onc.getUrlFromResponse(e)),e.data&&0==e.data.statusCode)r.addData(e.data.payload,t),n(e);else switch(e.data.statusCode){case 105:o(new Error("Failed to obtain data for sensor ".concat(t," with the provided filters.")));default:o(new Error("The data request for sensor ".concat(t," failed.")))}}),(function(t){t.response&&t.response.data&&r.requestURLs.push(r._onc.getUrlFromResponse(t.response)),o(t)}))})));case 2:case"end":return n.stop()}}))}},{key:"addData",value:function(t,e){var r=t.data.length,n={title:t.name,unit:t.uofm,samples:{times:new Array(r),qaqc:new Array(r)}};"MinMax"!=this.mode&&(n.samples.values=new Array(r)),"Avg"!=this.mode&&(n.samples.max=new Array(r),n.samples.min=new Array(r));this.data.length;var o=9999999,a=-9999999;if("Avg"==this.mode)for(var i=0;i<r;i++)n.samples.times[i]=t.data[i][0],this.isClean&&""===t.data[i][1]?(n.samples.values[i]=null,n.samples.qaqc[i]=null):(n.samples.values[i]=t.data[i][1],n.samples.qaqc[i]=t.data[i][2]);else if("MinMax"==this.mode)for(var s=0;s<r;s++)n.samples.times[s]=t.data[s][0],this.isClean&&""===t.data[s][1]?(n.samples.min[s]=null,n.samples.max[s]=null,n.samples.qaqc[s]=null):(n.samples.min[s]=t.data[s][1],n.samples.max[s]=t.data[s][2],n.samples.qaqc[s]=t.data[s][3]);else if("MinMaxAvg"==this.mode)for(var l,c=!1,u=0;u<r;u++)n.samples.times[u]=t.data[u][0],this.isClean&&""===t.data[u][2]?(c||(n.samples.times[u]=t.data[u-1][0],l=n.samples.values[u-1],c=!0),n.samples.min[u]=l,n.samples.max[u]=l):c?(c=!1,n.samples.min[u]=t.data[u][3],n.samples.max[u]=t.data[u][3]):(n.samples.min[u]=t.data[u][1],n.samples.max[u]=t.data[u][2]),n.samples.values[u]=t.data[u][3],n.samples.qaqc[u]=t.data[u][4],n.samples.min[u]<o&&(o=n.samples.min[u]),n.samples.max[u]>a&&(a=n.samples.max[u]);n.range=[o,a],this.data.push(n)}},{key:"optionCode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"MinMaxAvg";switch(t){case"Avg":return 1;case"MinMax":return 2;case"MinMaxAvg":return 3}return 0}}]),e}(at),l()(J.prototype,"download",[u],Object.getOwnPropertyDescriptor(J.prototype,"download"),J.prototype),l()(J.prototype,"reload",[u],Object.getOwnPropertyDescriptor(J.prototype,"reload"),J.prototype),l()(J.prototype,"addData",[u],Object.getOwnPropertyDescriptor(J.prototype,"addData"),J.prototype),J),ut=(it=function(){function t(e,r,n){o()(this,t),this.label="Add raw data",this.engine=null,this.ds=new ct(e,r,n),this.ds.isClean=!1,this.ds.mode="MinMax"}return i()(t,[{key:"toggle",value:function(){var t=this;return this.ds.hasData()||this.ds.download().then((function(e){var r=e[0].samples.times.concat(e[0].samples.times),n=e[0].samples.min.concat(e[0].samples.max);t.engine.addPlot(r,n,"Raw")}),(function(t){return reject(t)})),!1}}]),t}(),l()(it.prototype,"toggle",[u],Object.getOwnPropertyDescriptor(it.prototype,"toggle"),it.prototype),it),dt=(st=function(){function t(e,r){o()(this,t),A()(t,this,"download","renderContents"),this.idx=0,this.filters={},this._onc=r,this.type="",this.source="",this.ds=null,this.title="",this.parser=new N,this.statusBox=null,this.status="normal",this.loaderIsVisible=!0,this.menu=new U(this),this.dom={base:e,header:null,footer:null,content:null,headerLoader:null},this.options={report:!1,showWarnings:!0,theme:"default",engine:{}},this.addons={},this.warnings=[],this.cancelled=!1;try{this.parse(this.dom.base),this.renderBase(),this.statusBox=new q(this.dom.content,this.cancel)}catch(t){this.statusBox=new q(this.dom.base,this.cancel),this.showStatus("error",t.message),this.cancel()}}return i()(t,[{key:"parse",value:function(t){try{var e=this.parser.parse(t);if(console.log(e),this.parser.errors.length>0)throw new Error(this.parser.errors.join("<br>"));this.type=e.type,this.title=e.title,this.source=e.source,this.filters=e.filters,this.options.engine=e.engine,this.addAddons(e.addons),this.addOptions(e.options)}catch(t){throw this.cancel(),console.log(t),new Error("<b>Parsing error:</b><p>".concat(t.message,"</p>"))}}},{key:"addAddons",value:function(t){if(t){var e=!0,r=!1,n=void 0;try{for(var o,a=t[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var i=o.value;"report"==i?(this.addons.report=new Q(this),this.menu.addItem(i,this.addons.report.label,this.addons.report.toggle)):"csv"==i?(this.addons.csv=new tt(this),this.menu.addItem(i,this.addons.csv.label,this.addons.csv.download)):"pulink"==i&&"plot"==this.type?(this.addons.pulink=new et(this.filters),this.menu.addItem(i,this.addons.pulink.label,this.addons.pulink.open)):"raw"==i&&"plot"==this.type&&"plottingUtility"==this.source&&(this.addons.raw=new ut(this._onc,this.filters,this.showHeaderLoader),this.menu.addItem(i,this.addons.raw.label,this.addons.raw.toggle))}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}}}},{key:"addOptions",value:function(t){for(var e in t)this.options[e]=t[e]}},{key:"renderBase",value:function(){var t=this;for(var e in this.dom.base.classList.add("theme_".concat(this.options.theme)),this.dom.base.classList.add("widget_".concat(this.type)),this.dom.base.innerHTML='<div class="header"></div><div class="contents"></div><div class="footer"></div>',this.dom.header=this.dom.base.querySelector("div.header"),this.dom.footer=this.dom.base.querySelector("div.footer"),this.dom.content=this.dom.base.querySelector("div.contents"),this.dom.base.addEventListener("click",(function(e){e.target.closest(".menu")||t.menu.hide()})),this.addons)"function"==typeof this.addons[e].preRender&&this.addons[e].preRender()}},{key:"render",value:function(){this.renderContents(),this.renderHeader()}},{key:"renderHeader",value:function(){if(console.log(this),this.title){var t=document.createElement("h3");t.innerHTML=this.title,this.dom.header.appendChild(t)}if(this.dom.headerLoader=document.createElement("div"),this.dom.headerLoader.classList.add("loaderWrap"),this.dom.headerLoader.innerHTML='<div class="loader"></div>',this.dom.header.appendChild(this.dom.headerLoader),this.menu.items.length>0){var e=this.menu.render();this.dom.header.appendChild(e)}}},{key:"refreshDateRangeFilters",value:function(){var t=this.parser.userDates,e=M(t.dateFrom,t.dateTo);e.dateFrom&&(this.filters.dateFrom=e.dateFrom),e.dateTo&&(this.filters.dateTo=e.dateTo)}},{key:"showStatus",value:function(t,e){switch(this.dom.content||this.renderBase(),t){case"api_error":this.status="api_error";break;default:this.status="error"}this.statusBox.showMessage(t,e,this.filters),this.options.report&&new WidgetReport(this)}},{key:"showLoader",value:function(t,e){"hide"==t?this.hideLoader():this.loaderIsVisible&&this.statusBox.showLoader(t,e)}},{key:"hideLoader",value:function(){this.statusBox.remove()}},{key:"showHeaderLoader",value:function(t,e){"loading"==t?this.dom.headerLoader.classList.add("active"):this.dom.headerLoader.classList.remove("active")}},{key:"cancel",value:function(){this.cancelled=!0,this.ds&&this.ds.cancel()}},{key:"addWarning",value:function(t){this.warnings.push("<b>Warning:</b> "+t)}},{key:"getOption",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.options[t]||!1===this.options[t]?this.options[t]:e}}]),t}(),l()(st.prototype,"addAddons",[u],Object.getOwnPropertyDescriptor(st.prototype,"addAddons"),st.prototype),l()(st.prototype,"render",[u],Object.getOwnPropertyDescriptor(st.prototype,"render"),st.prototype),l()(st.prototype,"renderHeader",[u],Object.getOwnPropertyDescriptor(st.prototype,"renderHeader"),st.prototype),l()(st.prototype,"refreshDateRangeFilters",[u],Object.getOwnPropertyDescriptor(st.prototype,"refreshDateRangeFilters"),st.prototype),l()(st.prototype,"showStatus",[u],Object.getOwnPropertyDescriptor(st.prototype,"showStatus"),st.prototype),l()(st.prototype,"showLoader",[u],Object.getOwnPropertyDescriptor(st.prototype,"showLoader"),st.prototype),l()(st.prototype,"showHeaderLoader",[u],Object.getOwnPropertyDescriptor(st.prototype,"showHeaderLoader"),st.prototype),l()(st.prototype,"cancel",[u],Object.getOwnPropertyDescriptor(st.prototype,"cancel"),st.prototype),st),ht="1",pt="0",ft="Dany Cabrera (dcabrera@oceannetworks.ca)",yt="MIT",vt=function(t){function e(t,r){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return o()(this,e),(n=w()(this,x()(e).call(this,t,null))).code=r,n.message=a,n}return C()(e,t),i()(e,[{key:"download",value:function(){return new Promise((function(t){return t()}))}},{key:"renderContents",value:function(){"version"==this.code?this.renderVersion():this.showStatus(this.code,this.message)}},{key:"renderVersion",value:function(){var t="<b>ONC Data Widgets Library</b><br>";t+="<b>Version:</b> ".concat(ht,".").concat(pt,"<br>"),t+="<b>Author:</b> ".concat(ft,"<br>"),t+="<b>License:</b> ".concat(yt),this.showStatus("info",t)}}]),e}(dt),mt=(lt=function(t){function e(t,r,n){var a;return o()(this,e),(a=w()(this,x()(e).call(this,"discovery")))._onc=t,a.filters=r,a.service="",a.cbkShowLoader=n,a}return C()(e,t),i()(e,[{key:"getDeviceCodeForId",value:function(t){var e=this;return new Promise((function(r,n){e._onc.getDevices({deviceId:t}).then((function(t){if(e.cancelFlag)n("canceled");else{var o=t.data[0].deviceCode;r(o)}}),(function(t){return n(t)}))}))}},{key:"download",value:function(){var t;return nt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logDownloadStart(),!this.filters.sensorId||"devices"==this.service){e.next=15;break}return t=this.filters.sensorId,this.cbkShowLoader("waiting","Getting deviceCode for id ".concat(t)),e.prev=4,e.next=7,nt.a.awrap(this.getDeviceCodeForId(t));case 7:e.sent,e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(4),new Error("An error occurred while trying to get the device code for sensor with ID "+t);case 13:this.filters.deviceCode=deviceCode,delete this.filters.sensorId;case 15:this.cbkShowLoader("loading","Loading: ".concat(this.service)),e.t1=this.service,e.next="locations"===e.t1?19:"locationsTree"===e.t1?21:"deployments"===e.t1?23:"deviceCategories"===e.t1?25:"devices"===e.t1?27:"properties"===e.t1?29:"dataProducts"===e.t1?31:33;break;case 19:return e.abrupt("return",this.simpleRequest(this._onc.getLocations));case 21:return e.abrupt("return",this.simpleRequest(this._onc.getLocations,"getTree"));case 23:return e.abrupt("return",this.simpleRequest(this._onc.getDeployments));case 25:return e.abrupt("return",this.simpleRequest(this._onc.getDeviceCategories));case 27:return e.abrupt("return",this.simpleRequest(this._onc.getDevices));case 29:return e.abrupt("return",this.simpleRequest(this._onc.getProperties));case 31:return e.abrupt("return",this.simpleRequest(this._onc.getDataProducts));case 33:case"end":return e.stop()}}),null,this,[[4,10]])}},{key:"simpleRequest",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"get";return new Promise((function(n,o){t(e.filters,r).then((function(t){e.cancelFlag?o("canceled"):(e.logDownloadEnd(),e.performance.downloadSize=t.request.responseText.length,e.data=t.data,e.saveRequestURL(t),n())}),(function(t){return o(t)}))}))}},{key:"saveRequestURL",value:function(t){t&&t.request&&this.requestURLs.push(this._onc.getUrlFromResponse(t))}},{key:"setService",value:function(t){this.service=t}}]),e}(at),l()(lt.prototype,"download",[u],Object.getOwnPropertyDescriptor(lt.prototype,"download"),lt.prototype),l()(lt.prototype,"simpleRequest",[u],Object.getOwnPropertyDescriptor(lt.prototype,"simpleRequest"),lt.prototype),lt),gt=function(t){function e(t,r){var n;return o()(this,e),(n=w()(this,x()(e).call(this,t,r))).ds=new mt(r),n}return C()(e,t),i()(e,[{key:"download",value:function(){return this.showLoader("loading","Loading locations tree"),this.ds.request("locationsTree",this.filters)}},{key:"renderContents",value:function(){if(this.ds.hasData()){var t;t="ONC"==this.ds.data[0].locationCode?this.ds.data[0].children:this.ds.data;var e=document.createElement("table");e.className="oncTable",e.createTHead().insertRow(0).innerHTML=$(["locationName","locationCode","hasDeviceData","hasPropertyData"],"th");var r=e.createTBody(),n=!0,o=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var l=i.value;this.addRow(null,l,r)}}catch(t){o=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}this.removeStatusMsg(),this.domNode.appendChild(e)}}},{key:"addRow",value:function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=e.locationCode,i=e.dataSearchURL?'<a target="_blank" href="'.concat(e.dataSearchURL,'">').concat(e.locationName,"</a>"):e.locationName,s=['<span class="trail"></span>'.concat(i),a,e.hasDeviceData,e.hasPropertyData],l=$(s,"td","title"),c=r.insertRow(-1);if(c.classList.add("d_".concat(n)),n>0&&c.classList.add("child"),t&&c.setAttribute("data-parent",t),o&&c.classList.add("lastLeaf"),c.innerHTML=l,e.children){c.querySelector("span.trail").appendChild(Y(a));for(var u=e.children.length,d=0;d<u;d++)this.addRow(a,e.children[d],r,n+1,d==u-1)}}},{key:"filterRules",value:function(){return{locationCode:null,deviceCategoryCode:null,deviceCode:null,propertyCode:null,dataProductCode:null,dateFrom:null,dateTo:null,locationName:null}}}]),e}(dt),wt=function(t){function e(t,r){var n;return o()(this,e),(n=w()(this,x()(e).call(this,t,r))).ds=new mt(r,n.filters,n.showLoader),n.ds.setService("locations"),n}return C()(e,t),i()(e,[{key:"download",value:function(){return this.ds.download()}},{key:"renderContents",value:function(){if(this.ds.hasData()){var t="",e=!0,r=!1,n=void 0;try{for(var o,a=this.ds.data[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var i=o.value;t+="<tr>"+this.renderElement(i)+"</tr>"}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}this.dom.content.innerHTML=H(["locationName","locationCode","deployments","depth","lat","lon","hasDeviceData","hasPropertyData"],t)}}},{key:"renderElement",value:function(t){return $([t.dataSearchURL?'<a target="_blank" href="'.concat(t.dataSearchURL,'">').concat(t.locationName,"</a>"):t.locationName,t.locationCode,t.deployments,t.depth,t.lat,t.lon,t.hasDeviceData,t.hasPropertyData],"td")}},{key:"filterRules",value:function(){return{locationCode:null,deviceCategoryCode:null,deviceCode:null,propertyCode:null,dataProductCode:null,dateFrom:null,dateTo:null,locationName:null}}}]),e}(dt),bt=function(t){function e(t,r){var n;return o()(this,e),(n=w()(this,x()(e).call(this,t,r))).ds=new mt(r,n.filters,n.showLoader),n.ds.setService("deviceCategories"),n}return C()(e,t),i()(e,[{key:"download",value:function(){return this.ds.download()}},{key:"renderContents",value:function(){if(this.ds.hasData()){var t="",e=!0,r=!1,n=void 0;try{for(var o,a=this.ds.data[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var i=o.value;t+="<tr>"+this.renderElement(i)+"</tr>"}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}this.dom.content.innerHTML=H(["deviceCategoryName","deviceCategoryCode","hasDeviceData"],t)}}},{key:"renderElement",value:function(t){var e=t.deviceCategoryName;return t.cvTerm&&t.cvTerm.deviceCategory&&t.cvTerm.deviceCategory.length>0&&(e='<a target="_blank" href="'.concat(t.cvTerm.deviceCategory[0].uri,'">').concat(e,"</a>")),$([e,t.deviceCategoryCode,t.hasDeviceData],"td")}}]),e}(dt),xt=function(t){function e(t,r){var n;return o()(this,e),(n=w()(this,x()(e).call(this,t,r))).ds=new mt(r,n.filters,n.showLoader),n.ds.setService("devices"),n}return C()(e,t),i()(e,[{key:"download",value:function(){return this.ds.download()}},{key:"renderContents",value:function(){if(this.ds.hasData()){var t="",e=!0,r=!1,n=void 0;try{for(var o,a=this.ds.data[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var i=o.value;t+="<tr>"+this.renderElement(i)+"</tr>"}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}this.dom.content.innerHTML=H(["deviceId","deviceName","deviceCode","hasDeviceData"],t)}}},{key:"renderElement",value:function(t){var e=t.deviceLink?'<a target="_blank" href="'.concat(t.deviceLink,'">').concat(t.deviceName,"</a>"):t.deviceName;return $([t.deviceId,e,t.deviceCode,t.hasDeviceData],"td")}}]),e}(dt),kt=function(t){function e(t,r){var n;return o()(this,e),(n=w()(this,x()(e).call(this,t,r))).ds=new mt(r,n.filters,n.showLoader),n.ds.setService("properties"),n}return C()(e,t),i()(e,[{key:"download",value:function(){return this.ds.download()}},{key:"renderContents",value:function(){if(this.ds.hasData()){var t="",e=!0,r=!1,n=void 0;try{for(var o,a=this.ds.data[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var i=o.value;t+="<tr>"+this.renderElement(i)+"</tr>"}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}this.dom.content.innerHTML=H(["propertyName","propertyCode","uom","hasDeviceData","hasPropertyData"],t)}}},{key:"renderElement",value:function(t){var e=t.propertyName;return t.cvTerm&&t.cvTerm.property&&t.cvTerm.property.length>0&&(e='<a target="_blank" href="'.concat(t.cvTerm.property[0].uri,'">').concat(e,"</a>")),$([e,t.propertyCode,t.uom,t.hasDeviceData,t.hasPropertyData],"td")}}]),e}(dt),Ct=function(t){function e(t,r){var n;return o()(this,e),(n=w()(this,x()(e).call(this,t,r))).ds=new mt(r,n.filters,n.showLoader),n.ds.setService("deployments"),n}return C()(e,t),i()(e,[{key:"download",value:function(){return this.ds.download()}},{key:"renderContents",value:function(){if(this.ds.hasData()){var t="",e=!0,r=!1,n=void 0;try{for(var o,a=this.ds.data[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var i=o.value;t+="<tr>"+this.renderElement(i)+"</tr>"}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}this.dom.content.innerHTML=H(["locationCode","deviceCode","begin","end","hasDeviceData","depth","lat","lon"],t)}}},{key:"renderElement",value:function(t){var e=t.end?t.end:"(unknown)",r=t.begin?t.begin:"(unknown)";return $([t.locationCode,t.deviceCode,r,e,t.hasDeviceData,t.depth,t.lat,t.lon],"td")}}]),e}(dt),Dt=function(t){function e(t,r){var n;return o()(this,e),(n=w()(this,x()(e).call(this,t,r))).ds=new mt(r,n.filters,n.showLoader),n.ds.setService("dataProducts"),n}return C()(e,t),i()(e,[{key:"download",value:function(){return this.ds.download()}},{key:"renderContents",value:function(){if(this.ds.hasData()){var t="",e=!0,r=!1,n=void 0;try{for(var o,a=this.ds.data[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var i=o.value;t+="<tr>"+this.renderElement(i)+"</tr>"}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}this.dom.content.innerHTML=H(["dataProductName","dataProductCode","extension","hasDeviceData","hasPropertyData"],t)}}},{key:"renderElement",value:function(t){return $([t.helpDocument?'<a target="_blank" href="'.concat(t.helpDocument,'">').concat(t.dataProductName,"</a>"):t.dataProductName,t.dataProductCode,t.extension,t.hasDeviceData,t.hasPropertyData],"td")}}]),e}(dt),St=function(){function t(e){o()(this,t),this.domNode=e,this.data={x:[],y:[],name:""},this.operation="",this.params=[],this._opsConfig={smooth:{run:this.opSmooth,params:["number"],defaults:[5]}},this._validOps=["smooth"],this.parsed=this.parse();var r=this.domNode.getAttribute("title");this.data.name=r||this.operation,this.opSmooth=this.opSmooth.bind(this)}return i()(t,[{key:"parse",value:function(){var t=this.domNode.dataset.operation;if(!new RegExp(/[a-zA-Z0-9_]+\([a-zA-Z0-9_,]*\)/g).exec(t))return!1;if(this.operation=t.substring(0,t.indexOf("(")),!this._validOps.includes(this.operation))return!1;var e=t.substring(this.operation.length+1,t.length-1);this.params=this._opsConfig[this.operation].defaults;for(var r=e.split(","),n=0;n<r.length;n++)this.params[n]=r[n];for(var o="",a=0;a<this.params.length;a++)"true"==(o=this.params[a].trim())?this.params[a]=!0:"false"==o?this.params[a]=!1:T(o)?this.params[a]=parseFloat(o):this.params[a]=o;return!0}},{key:"compute",value:function(t,e){switch(this.operation){case"smooth":this.opSmooth(t,e)}}},{key:"opSmooth",value:function(t,e){var r=e.length,n=this.params[0];if(n%2==0&&n++,this.data.x=t,r<=2)this.data.y=e;else{this.data.y=new Array(r);var o=0,a=0,i=0,s=0,l=0,c=(n-1)/2;for(o=0;o<r;o++){for(o<c?(s=0,l=o+o):(s=o-c,l=o+c),l>=r&&(l=r-1),i=0,a=s;a<=l;a++)i+=e[a];this.data.y[o]=i/(l-s+1)}}}}]),t}(),Ot=function(t){function e(t,r,n){var a;return o()(this,e),(a=w()(this,x()(e).call(this,"scalardata")))._onc=t,a.filters=r,a.requestPropCount=1,a.sensorCount=0,a.sampleCount=0,a.next=null,a.pages={count:0,timeAvg:0,timeStart:null,timeEnd:null,rangeAvg:0,rangeStart:null,rangeEnd:null,totalRange:0,avgTotalCount:0},a.cbkShowLoader=n,a}return C()(e,t),i()(e,[{key:"download",value:function(){var t=this;return this.data=[],new Promise((function(e,r){var n,o,a;return nt.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:n=t.filters,o=S()(n.dateFrom),a=n.dateTo?S()(n.dateTo):S.a.utc(),t.pages.totalRange=o.diff(a,"second"),i.prev=4;case 5:return i.next=7,nt.a.awrap(t.downloadPage(n));case 7:if(n=t.next?t.next.parameters:null,!t.cancelFlag){i.next=11;break}return r("canceled"),i.abrupt("return");case 11:if(t.next){i.next=5;break}case 12:i.next=17;break;case 14:i.prev=14,i.t0=i.catch(4),r(i.t0);case 17:t.hasData()?(t.addPerformanceMsg("Downloaded ".concat(t.sensorCount," properties.")),t.addPerformanceMsg("Downloaded ".concat(t.sampleCount.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")," samples for each property.")),t.addPerformanceMsg("Data downloaded in ".concat(t.pages.count," pages.")),t.pages.count>1&&t.addPerformanceMsg("Pages carry data for an average time range of ".concat(E(t.pages.rangeAvg),".")),t.sensorCount<t.requestPropCount&&t.addWarning("The server only found data for ".concat(t.sensorCount," of the ").concat(t.requestPropCount," requested properties (").concat(t.filters.sensorCategoryCodes,") for the filters provided."))):t.addPerformanceMsg("No data downloaded."),e();case 19:case"end":return i.stop()}}),null,null,[[4,14]])}))}},{key:"downloadPage",value:function(t){var e=this;return nt.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise((function(r,n){e.logPageDownloadStart(t),e.cbkShowLoader("loading","Loading plot data"),e._onc.getScalarData(t).then((function(t){if(e.cancelFlag)n("canceled");else if(t.data.sensorData){e.next=t.data.next;var o=t.data.sensorData;if(e.hasData()){for(var a=0;a<e.sensorCount;a++)for(var i=o[a].sensorCode,s=0;s<e.sensorCount;s++)if(e.data[s].sensorCode==i){e.data[s].samples.values.concat(o[a].data.values),e.data[s].samples.times.concat(o[a].data.sampleTimes),e.data[s].samples.qaqc.concat(o[a].data.qaqcFlags);break}}else{e.sensorCount=o.length;for(var l=0;l<e.sensorCount;l++)e.data.push({sensorCode:o[l].sensorCode,title:o[l].sensorName,unit:o[l].unitOfMeasure,samples:{values:o[l].data.values,times:o[l].data.sampleTimes,qaqc:o[l].data.qaqcFlags}})}if(e.sampleCount=e.data[0].samples.values.length,e.pages.count++,e.performance.downloadSize+=t.request.responseText.length,e.logPageDownloadEnd(t.data.next),e.requestURLs.push(t.data.queryUrl),e.next){var c="Downloading data<br>page ".concat(e.pages.count+1," of &asymp;").concat(Math.ceil(e.pages.avgTotalCount));e.cbkShowLoader("loading",c)}r()}else n("empty")}),(function(t){console.log(t),t.response&&t.response.data&&e.requestURLs.push(e._onc.getUrlFromResponse(t.response)),n(t)}))})));case 1:case"end":return r.stop()}}))}},{key:"assignDataIds",value:function(){var t,e,r,n=[];this.filters.sensorCategoryCodes?n=this.filters.sensorCategoryCodes.split(","):this.filters.propertyCode&&(n=[this.filters.propertyCode]);for(var o=0;o<n.length;o++)n[o]=n[o].toLowerCase();for(var a=0;a<this.data.length;a++)e=(t=this.data[a]).sensorCode.toLowerCase(),r=t.sensorCategoryCode.toLowerCase(),n.includes(e)?this.data[a].id=e:n.includes(e)?this.data[a].id=r:this.data[a].id=t.sensorName.toLowerCase()}},{key:"disconnectDataHoles",value:function(){var t,e,r,n=this.data[0].sampleTimes.length-1,o=moment(this.data[0].sampleTimes[0],moment.ISO_8601),a=moment(this.data[0].sampleTimes[1],moment.ISO_8601),i=moment(this.data[0].sampleTimes[2],moment.ISO_8601);for(e=a.diff(o),t=1;t<n;t++)(r=i.diff(a))>30*e&&(this.sensorData.values[t]=null),o=a,a=i,i=moment(this.data[0].sampleTimes[t+2],moment.ISO_8601),e=r}},{key:"logPageDownloadStart",value:function(t){this.pages.rangeStart=S()(t.dateFrom),this.pages.timeStart=S()()}},{key:"logPageDownloadEnd",value:function(t){this.pages.timeEnd=S()();var e=this.pages.timeEnd.diff(this.pages.timeStart,"second"),r=this.pages.timeAvg;if(this.pages.timeAvg=0==r?e:.5*(r+e),t&&t.parameters.dateFrom){var n=S()(t.parameters.dateFrom);this.pages.rangeEnd=n;var o=this.pages.rangeStart.diff(this.pages.rangeEnd,"second"),a=this.pages.rangeAvg;if(0==a)this.pages.rangeAvg=o;else{var i=this.pages.count;this.pages.rangeAvg=(1-1/i)*a+1/i*o}this.pages.avgTotalCount=this.pages.totalRange/this.pages.rangeAvg}}}]),e}(at),Lt=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#393b79","#637939","#e7ba52","#843c39","#d6616b","#7b4173","#636363","#000000"];function Tt(t){return Lt.slice(0,t)}function Pt(t){for(var e=0,r=0;r<t.length;r++)e+=t.charCodeAt(r);var n=Lt.length;return Lt[e%=n]}function Mt(t,e){3==(t=t.replace(/^\s*#|\s*$/g,"")).length&&(t=t.replace(/(.)/g,"$1$1"));var r=parseInt(t.substr(0,2),16),n=parseInt(t.substr(2,2),16),o=parseInt(t.substr(4,2),16);return"#"+(0|256+r+(256-r)*e).toString(16).substr(1)+(0|256+n+(256-n)*e).toString(16).substr(1)+(0|256+o+(256-o)*e).toString(16).substr(1)}var Et,_t,Rt,Ft,jt,At,It,Nt,qt,Ut,$t=function(){function t(e,r,n){o()(this,t),A()(t,this,"prepareDataset","prepareLayout","render","isEngineAvailable"),this.api=null,this.series=[],this.plotCount=0,this.domNode=e,this.name=r,this.config=n,this.CDN="",this.vendorURL="",this.colors=[],this.colorDefaults=Tt(12),this.parseColors()}return i()(t,[{key:"parseColors",value:function(){this.colors=this.colorDefaults;var t=this.getOption("colors",null);if(t){var e=t.split(";");if(e)for(var r=0;r<e.length;r++)this.colors[r]=e[r];else this.colors[0]=t}}},{key:"isTimeSeries",value:function(){return"time"==this.controlVariable}},{key:"colorForIndex",value:function(t){return t<this.colorDefault.length?this.colorDefault[t]:this.colorDefault[t-this.colorDefault.length]}},{key:"errorUnavailable",value:function(){return new Error('<p>The plot engine <b>"'.concat(this.name,'"</b> is unavailable.</p>\n        <p>You can add this library as a <em>&lt;script&gt;</em> with the <em>src</em>: <a href="').concat(this.CDN,'" target="_BLANK">').concat(this.CDN,'</a></p>\n        <p>You can also obtain the original library at <a href="').concat(this.vendorURL,'" target="_BLANK">').concat(this.vendorURL,"</a>.</p>"))}},{key:"getOption",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.config.engine[t]||!1===this.config.engine[t]?this.config.engine[t]:e}}]),t}(),Ht=(Et=function(t){function e(t,r){var n;return o()(this,e),(n=w()(this,x()(e).call(this,t,"plotly",r))).CDN="http://onc.danycabrera.com/engines/plotly.min.js",n.vendorURL="https://github.com/plotly/plotly.js",n.options={mode:n.getOption("mode",n.config.isTimeSeries?"lines":"markers"),stack:n.getOption("stack","none"),stackTitles:n.getOption("stackTitles",!0),reversed:n.getOption("reversed",!1)},n.yRange=[null,null],n.independentAxisTitle="",n.layout={},n}return C()(e,t),i()(e,[{key:"prepareDataset",value:function(t){this.series=t}},{key:"addPlot",value:function(t,e,r){var n=[{type:"scattergl",mode:"markers",marker:{size:3},name:r,x:t,y:e}];Plotly.addTraces(this.domNode,n)}},{key:"parseSeries",value:function(t){for(var e=null,r=t.length,n=this.options.stack,o=Array(),a=0;a<r;a++){e=t[a],"rows"==n&&a>0?"y"+(a+1):"columns"==n&&a>0&&"x"+(a+1),this.yRange=e.range;var i=this.parseMinMaxPlot(e);o.push(i[0],i[1],i[2])}return o}},{key:"parseMinMaxPlot",value:function(t){var e=Array(3);return e[0]={type:"scatter",mode:"lines",legendgroup:t.title,connectgaps:!1,line:{width:0},showlegend:!1,hoverinfo:"skip",x:t.samples.times,y:t.samples.max},e[1]={type:"scatter",mode:"lines",legendgroup:t.title,connectgaps:!1,fill:"tonexty",fillcolor:"#b7eaff",line:{width:0},showlegend:!1,hoverinfo:"skip",x:t.samples.times,y:t.samples.min},e[2]={type:"scatter",line:{color:"#3399cc",width:1},mode:"lines",legendgroup:t.title,connectgaps:!1,name:"".concat(t.title," [").concat(t.unit,"]"),x:t.samples.times,y:t.samples.values},e}},{key:"prepareXY",value:function(t){for(var e=null,r=t.length,n=this.config,o="x"==n.independent,a=[],i=o?n.x[0]:n.y[0],s=0;s<r;s++)if(t[s].id==i){a=t[s].data.values,this.independentAxisTitle="".concat(t[s].sensorName," [").concat(t[s].unitOfMeasure,"]");break}var l=0;this.series=new Array(r-1);for(var c=0;c<r;c++)t[c].id!=i&&(e=t[c],this.series[l]={type:"scatter",mode:this.options.mode,name:"".concat(e.sensorName," [").concat(e.unitOfMeasure,"]"),x:o?a:e.data.values,y:o?e.data.values:a},l++)}},{key:"prepareLayout",value:function(){this.parseColors();var t={family:"Arial, Sans",size:10,color:"black"},e=this.config,r="x"==e.independent,n=e.engine,o=this.series.length,a={showlegend:!0,colorway:this.colors,legend:{yanchor:"top",y:1.1,orientation:"h"},xaxis:{automargin:!0,type:"date",showline:!0,zeroline:!1},yaxis:{automargin:!0,showline:!0,zeroline:!1,range:this.yRange,type:"linear"},connectgaps:!1,margin:{l:55,r:55,b:40,t:30,pad:0},hovermode:"closest"};e.isTimeSeries||(a.xaxis.type="linear"),this.options.reversed&&(a.yaxis.autorange="reversed",a.xaxis.side="top");var i="";if(1==o)e.isTimeSeries?(i="".concat(this.series[0].title," [").concat(this.series[0].unit,"]"),a.showlegend=!0,a.yaxis.title={text:i,font:{family:"Arial, Sans",size:12,color:this.colors[0]}}):(a.showlegend=!1,i="".concat(this.series[0].title," [").concat(this.series[0].unit,"]"),a.xaxis.title={text:this.independentAxisTitle,font:{family:"Arial, Sans",size:12,color:"#000000"}},a.yaxis.title={text:i,font:{family:"Arial, Sans",size:12,color:"#000000"}});else if(o>1&&(e.isTimeSeries||(r?a.xaxis.title={text:this.independentAxisTitle,font:{family:"Arial, Sans",size:12,color:"#000000"}}:a.yaxis.title={text:this.independentAxisTitle,font:{family:"Arial, Sans",size:12,color:"#000000"}}),n.stack))switch(this.options.stackTitles&&(a.showlegend=!1),n.stack){case"rows":for(var s,l=0;l<o;l++)a[s="yaxis"+(0==l?"":l+1)]={showline:!0,zeroline:!1,side:l%2!=0?"right":"left",tickfont:t},this.options.stackTitles&&(a[s].title={text:this.series[l].title,font:{family:"Arial, Sans",size:12,color:this.colors[l]}});a.grid={rows:o,columns:1};break;case"columns":for(var c,u=0;u<o;u++)a[c="xaxis"+(0==u?"":u+1)]={showline:!0,tickfont:t},this.options.stackTitles&&(a[c].title={text:this.series[u].title,font:{family:"Arial, Sans",size:12,color:this.colors[u]}});a.grid={rows:1,columns:o}}this.layout=a}},{key:"render",value:function(){var t=this.parseSeries(this.series);this.prepareLayout(),this.api=Plotly.newPlot(this.domNode,t,this.layout,{responsive:!0,displaylogo:!1,showTips:!1,autoscaleYAxis:!0,modeBarButtonsToRemove:["zoomIn2d","zoomOut2d","hoverCompareCartesian","hoverClosestCartesian","autoScale2d"]})}},{key:"isEngineAvailable",value:function(){return!("undefined"==typeof Plotly)}}]),e}($t),l()(Et.prototype,"prepareDataset",[u],Object.getOwnPropertyDescriptor(Et.prototype,"prepareDataset"),Et.prototype),l()(Et.prototype,"addPlot",[u],Object.getOwnPropertyDescriptor(Et.prototype,"addPlot"),Et.prototype),l()(Et.prototype,"parseSeries",[u],Object.getOwnPropertyDescriptor(Et.prototype,"parseSeries"),Et.prototype),Et),Yt=(_t=function(t){function e(t,r,n){var a,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return o()(this,e),(a=w()(this,x()(e).call(this,t,"dygraphs",n))).CDN="http://onc.danycabrera.com/engines/dygraphs.min.js",a.vendorURL="http://dygraphs.com",a.options={rollPeriod:a.getOption("rollPeriod",0),animatedZooms:a.getOption("animatedZooms",!0),showRangeSelector:a.getOption("showRangeSelector",!1)},a.hasErrorInterval=!1,a.labels=["time"],a.yLabels=[],a.layout={},a.cbkZoom=i,a}return C()(e,t),i()(e,[{key:"prepareDataset",value:function(t){var e,r;this.series=t,this.plotCount=t.length,this.hasErrorInterval=t[0].samples.min;for(var n=0;n<t.length;n++)e=t[n].title,r=t[n].unit,this.labels.push(e),this.yLabels.push("".concat(e," [").concat(r,"]"))}},{key:"parseSeries",value:function(t){var e=t.length,r=t[0].samples.values.length,n=new Array(r);if(t[0].samples.min)for(var o=0;o<r;o++){n[o]=new Array(1+e),n[o][0]=new Date(t[0].samples.times[o]);for(var a=0;a<this.plotCount;a++)n[o][a+1]=[t[a].samples.min[o],t[a].samples.values[o],t[a].samples.max[o]]}else for(var i=0;i<r;i++){n[i]=new Array(1+e),n[i][0]=new Date(t[0].samples.times[i]);for(var s=0;s<e;s++)n[i][s+1]=t[s].samples.values[i]}return n}},{key:"prepareLayout",value:function(){this.layout={rollPeriod:this.options.rollPeriod,labels:this.labels,colors:this.colors,customBars:this.hasErrorInterval,fillAlpha:.3,animatedZooms:this.options.animatedZooms,axisLabelFontSize:12,showRangeSelector:this.options.showRangeSelector,hideOverlayOnMouseOut:!1},1==this.plotCount?this.layout.ylabel='<span style="color:'.concat(this.colors[0],'">').concat(this.yLabels[0],"</span>"):2==this.plotCount?(this.layout.ylabel='<span style="color:'.concat(this.colors[0],'">').concat(this.yLabels[0],"</span>"),this.layout.y2label='<span style="color:'.concat(this.colors[1],'">').concat(this.yLabels[1],"</span>"),this.layout.series={},this.layout.series[this.labels[1]]={axis:"y"},this.layout.series[this.labels[2]]={axis:"y2"},this.layout.axes={x:{axisLineColor:"#000"},y:{axisLineColor:this.colors[0]},y2:{axisLineColor:this.colors[1]}}):this.layout.legend="always"}},{key:"render",value:function(){var t=this.parseSeries(this.series);this.prepareLayout();var e=document.createElement("div");e.classList.add("dygraphWrap"),this.domNode.appendChild(e),this.api=new Dygraph(e,t,this.layout),this.series=null}},{key:"reload",value:function(){var t=this.parseSeries(this.series);this.prepareLayout(),this.api.updateOptions({file:t})}},{key:"isEngineAvailable",value:function(){return!("undefined"==typeof Dygraph)}}]),e}($t),l()(_t.prototype,"prepareDataset",[u],Object.getOwnPropertyDescriptor(_t.prototype,"prepareDataset"),_t.prototype),l()(_t.prototype,"render",[u],Object.getOwnPropertyDescriptor(_t.prototype,"render"),_t.prototype),l()(_t.prototype,"reload",[u],Object.getOwnPropertyDescriptor(_t.prototype,"reload"),_t.prototype),_t),Bt=(Rt=function(t){function e(t,r,n){var a,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return o()(this,e),(a=w()(this,x()(e).call(this,t,"uplot",r,n))).CDN="http://onc.danycabrera.com/engines/uplot.min.js",a.vendorURL="https://github.com/leeoniya/uPlot",a.options={rollPeriod:a.getOption("rollPeriod",0),animatedZooms:a.getOption("animatedZooms",!0),showRangeSelector:a.getOption("showRangeSelector",!1)},a.hasErrorInterval=!1,a.yLabel="",a.layout={},a.cbkZoom=i,a}return C()(e,t),i()(e,[{key:"prepareDataset",value:function(t){var e,r;this.series=t,this.plotCount=t.length,this.hasErrorInterval=t[0].samples.min;for(var n=0;n<t.length;n++){var o=Math.abs(t[n].range[0]-t[n].range[1]),a=1;o<.01?a=4:o>=.01&&o<.1?a=3:o>=.1&&o<1&&(a=2),this.decimals=a,e=t[n].title,r=t[n].unit,this.yLabel="".concat(e," [").concat(r,"]")}}},{key:"parseSeries",value:function(t){t.length;var e=t[0].samples.values.length,r=new Array(2);r[0]=new Array(e);for(var n=0;n<e;n++)r[0][n]=t[0].samples.times[n]/1e3;return r[1]=t[0].samples.min,r[2]=t[0].samples.max,r[3]=t[0].samples.values,r}},{key:"prepareLayout",value:function(){var t=this,e=Pt(this.yLabel),r=Mt(e,.6),n=3600;this.layout={width:this.domNode.offsetWidth,height:300,series:{y:[{label:"Min",color:e,fill:r,width:0,value:function(e,r){return e.toFixed(t.decimals)},band:!0},{label:"Max",color:e,fill:r,width:0,value:function(e,r){return e.toFixed(t.decimals)},band:!0},{label:"Avg",color:e,width:1,value:function(t,e){try{return t.toFixed(this.decimals)}catch(e){return t}}}]},axes:{y:[{label:this.yLabel,width:30}],x:{divisors:{day:[n,2*n,3*n,4*n,6*n,8*n]}}}}}},{key:"render",value:function(){var t=this.parseSeries(this.series);this.prepareLayout();var e=new uPlot(this.layout,t);this.domNode.appendChild(e.root)}},{key:"isEngineAvailable",value:function(){return!("undefined"==typeof uPlot)}}]),e}($t),l()(Rt.prototype,"prepareDataset",[u],Object.getOwnPropertyDescriptor(Rt.prototype,"prepareDataset"),Rt.prototype),l()(Rt.prototype,"render",[u],Object.getOwnPropertyDescriptor(Rt.prototype,"render"),Rt.prototype),Rt),zt=function(t){function e(t,r){var n;return o()(this,e),(n=w()(this,x()(e).call(this,t,"apexcharts",r))).CDN="http://onc.danycabrera.com/engines/apexcharts.min.js",n.vendorURL="https://apexcharts.com",n.options={chart:n.getOption("chart",n.config.isTimeSeries?"line":"scatter"),reversed:n.getOption("reversed",!1),animationDelay:n.getOption("animationDelay",0),strokeCurve:n.getOption("strokeCurve","smooth"),strokeWidth:n.getOption("strokeWidth",2)},n.mbr={xMin:999999999,xMax:0,yMin:999999999,yMax:0},n.independentAxisTitle="",n.layout={},n}return C()(e,t),i()(e,[{key:"prepareDataset",value:function(t){this.config.isTimeSeries?this.prepareTimeSeries(t):this.prepareXY(t)}},{key:"prepareTimeSeries",value:function(t){var e,r=t.length;this.datas=new Array(r);for(var n=0;n<r;n++){e=t[n].data.values.length,this.datas[n]={name:"".concat(t[n].sensorName," [").concat(t[n].unitOfMeasure,"]"),data:new Array(e)};for(var o=0;o<e;o++)this.datas[n].data[o]=[Date.parse(t[n].data.sampleTimes[o]),t[n].data.values[o]]}}},{key:"prepareXY",value:function(t){for(var e=this.config,r=t.length,n=[],o="x"==e.independent?e.x[0]:e.y[0],a=0;a<r;a++)if(t[a].id==o){n=t[a].data.values,this.independentAxisTitle="".concat(t[a].sensorName," [").concat(t[a].unitOfMeasure,"]");break}var i,s=0;this.datas=new Array(r-1);for(var l=0;l<r;l++)if(t[l].id!=o){i=t[l].data.values.length,this.datas[s]={name:"".concat(t[l].sensorName," [").concat(t[l].unitOfMeasure,"]"),data:new Array(i)};for(var c=void 0,u=void 0,d=0;d<i;d++)"x"==e.independent?(c=n[d],u=t[l].data.values[d]):(c=t[l].data.values[d],u=n[d]),c&&u?(this.datas[s].data[d]=[c,u],this.updateMBR(c,u)):(i--,this.datas[s].data.length--);s++}}},{key:"updateMBR",value:function(t,e){this.mbr.xMin>t?this.mbr.xMin=t:this.mbr.xMax<t&&(this.mbr.xMax=t),this.mbr.yMin>e?this.mbr.yMin=e:this.mbr.yMax<e&&(this.mbr.yMax=e)}},{key:"prepareLayout",value:function(){var t=this.config,e={chart:{type:this.options.chart,zoom:{enabled:!0,type:"x"},animations:{enabled:!1,easing:"easeinout",speed:800,animateGradually:{enabled:!1,delay:150},dynamicAnimation:{enabled:!0,speed:350}}},dataLabels:{enabled:!1},stroke:{curve:this.options.strokeCurve,width:this.options.strokeWidth},colors:this.colors,xaxis:{type:t.isTimeSeries?"datetime":"numeric",tickPlacement:"on",labels:{style:{fontSize:"11px"}}},yaxis:{type:"numeric",tickPlacement:"on",labels:{style:{fontSize:"11px"},title:{text:"hello"}},axisBorder:{show:!0},axisTicks:{show:!0}},legend:{show:!0,position:"top"},grid:{xaxis:{lines:{show:!0}},yaxis:{lines:{show:!0}}},series:this.datas};t.isTimeSeries?(e.tooltip={x:{format:"dd-MMM-yyyy HH:mm:dd.ffff"}},e.xaxis.title={text:"Time"},1==this.datas.length&&(e.yaxis.title={text:this.datas[0].name},e.yaxis.seriesName=this.datas[0].name)):(e.chart.type="scatter",e.xaxis.min=this.mbr.xMin,e.xaxis.max=this.mbr.xMax,e.yaxis.min=this.mbr.yMin,e.yaxis.max=this.mbr.yMax,e.markers={size:3},e.xaxis.labels.formatter=this.truncateDecimals,"x"==t.independent?(e.xaxis.title={text:this.independentAxisTitle},1==t.y.length&&(e.yaxis.title={text:this.datas[0].name})):(e.yaxis.title={text:this.independentAxisTitle},e.yaxis=[e.yaxis],1==t.x.length&&(e.xaxis.title={text:this.datas[0].name}))),this.options.reversed&&(e.yaxis.reversed=!0,e.xaxis.position="top",e.xaxis.title.offsetY=-50),this.options.animationDelay>0&&(e.chart.animations.enabled=!0,e.chart.animations.animateGradually={enabled:!0,delay:this.options.animationDelay}),this.layout=e,console.log(e)}},{key:"truncateDecimals",value:function(t,e,r){if(t%1!=0&&t.toString().split(".")[1].length>3)return t.toFixed(3);return t}},{key:"render",value:function(){new ApexCharts(this.domNode,this.layout).render()}},{key:"isEngineAvailable",value:function(){return!("undefined"==typeof ApexCharts)}}]),e}($t),Wt=(Ft=function(t){function e(t,r){var n;o()(this,e),(n=w()(this,x()(e).call(this,t,r))).engine=null,n.computedData=[],n.isTimeSeries=!0,n.plotConfig={x:[],y:[],colors:[],independent:"x",isTimeSeries:!0,horizontal:!0,engine:n.options.engine},""==n.source&&(n.source="scalardata");try{n.processFilters()}catch(t){throw t}switch(n.source){case"plottingUtility":n.ds=new ct(n._onc,n.filters,n.showLoader);break;case"scalardata":n.ds=new Ot(n._onc,n.filters,n.showLoader);break;default:throw new Error('Unrecognized data source for this plot widget: <b>"'.concat(n.source,'"</b>.'))}switch(n.options.engine.name){case"plotly":n.engine=new Ht(n.dom.content,n.plotConfig,n.options);break;case"uplot":n.engine=new Bt(n.dom.content,n.plotConfig,n.options,n.cbkZoom);break;case"dygraphs":n.engine=new Yt(n.dom.content,n.plotConfig,n.options,n.cbkZoom);break;case"apexcharts":n.engine=new zt(n.dom.content,n.plotConfig,n.options)}if(n.addons.raw&&(n.addons.raw.engine=n.engine),!n.engine.isEngineAvailable())throw n.engine.errorUnavailable();return n.ds.addPerformanceMsg("<b>Render engine:</b> ".concat(n.engine.name)),n}return C()(e,t),i()(e,[{key:"download",value:function(){var t,e=this,r=arguments;return nt.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return t=!(r.length>0&&void 0!==r[0])||r[0],this.loaderIsVisible=t,n.abrupt("return",new Promise((function(t,r){e.ds.download().then((function(n){var o=0,a=!0,i=!1,s=void 0;try{for(var l,c=e.ds.data[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){0==l.value.samples.qaqc.length&&o++}}catch(t){i=!0,s=t}finally{try{a||null==c.return||c.return()}finally{if(i)throw s}}o==e.ds.data.length&&r("empty"),e.createComputedDatasets(),t(n)}),(function(t){return r(t)}))})));case 3:case"end":return n.stop()}}),null,this)}},{key:"renderContents",value:function(){if(this.ds.hasData()){var t=!0,e=[];if(!this.plotConfig.isTimeSeries){for(var r in this.ds.data)e.push({id:this.ds.data[r].id,count:this.ds.data[r].data.values.length});for(var n=0;n<e.length-1;n++)e[n].count!=e[n+1].count&&(t=!1)}if(t)this.engine.prepareDataset(this.ds.data),this.statusBox.remove(),this.dom.base.classList.add("eng_"+this.engine.name),this.engine.render(),this.ds.clear();else{var o="All sensors in xy plots must have the same number of samples.<ul>",a=!0,i=!1,s=void 0;try{for(var l,c=e[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var u=l.value;o+="<li>Sensor ".concat(u.id," has ").concat(u.count," samples</li>")}}catch(t){i=!0,s=t}finally{try{a||null==c.return||c.return()}finally{if(i)throw s}}this.showStatus("error",o+"</ul>")}}else this.showStatus("info","No sensor data found for the filters specified.")}},{key:"cbkZoom",value:function(t,e,r){var n=this;this.ds.reload(S()(t),S()(e)).then((function(t){n.engine.prepareDataset(t),n.engine.reload()}))}},{key:"loadLocation",value:function(){var t=this;this.ds.sensorIds[0];if(this.filters.deviceId){var e=this.filters.deviceId;return new Promise((function(r,n){var o,a,i,s,l;return nt.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,nt.a.awrap(t._onc.getDevices({deviceId:e}));case 2:if(200!=(o=c.sent).status||1!=o.data.length){c.next=13;break}return a=o.data[0].deviceCode,i=t.filters.dateFrom,s=t.filters.dateTo,c.next=9,nt.a.awrap(t._onc.getLocations({deviceCode:a,dateFrom:i,dateTo:s}));case 9:200==(l=c.sent).status&&1==l.data.length&&(t.location=l.data[0],r(t)),c.next=14;break;case 13:n("Couldn't get device with id ".concat(e));case 14:case"end":return c.stop()}}))}))}return new Promise((function(t,e){e("loadLocation(): Missing mandatory filter 'deviceId'")}))}},{key:"processFilters",value:function(){var t=this.filters;if(t.x||t.y){if(!t.x||!t.y)throw new Error("Both <b>data-x</b> and <b>data-y</b> are required for plots that are not time series.");switch(this.plotConfig.isTimeSeries=!1,this.plotConfig.x=W(t.x),this.plotConfig.y=W(t.y),1==this.plotConfig.y.length&&this.plotConfig.x.length>1&&(this.plotConfig.independent="y",this.plotConfig.horizontal=!1),delete this.filters.x,delete this.filters.y,this.source){case"plottingUtility":this.filters.sensorId=this.stringifySensorIds();break;case"scalardata":this.filters.sensorCategoryCodes=this.stringifySensorIds();break;case"dataProductDelivery":throw new Error("dataProductDelivery doesn't support multiple propertyCode yet.")}}else t.sensorId?this.plotConfig.y=W(t.sensorId):t.propertyCode&&(this.plotConfig.y=W(t.propertyCode));if(null!=this.plotConfig.engine.name&&""!=this.plotConfig.engine.name||(this.plotConfig.engine.name="plotly"),t.propertyCode&&t.propertyCode.indexOf(",")>-1&&(t.sensorCategoryCodes=t.propertyCode,delete t.propertyCode,this.addWarning("Multiple property codes detected in 'propertyCode'. Renamed attribute to 'sensorCategoryCodes' as required by the API.")),"dataProductDelivery"==this.source&&"average"==t.dpo_resample){var e=S.a.utc(t.dateFrom),r=S.a.utc(t.dateTo);if(r.diff(e,"second")<=t.dpo_average)throw new Error("The date range requested (".concat(r.diff(e,"second")," seconds) is too short for the resample period (").concat(t.dpo_average,") specified in <b>dpo_average</b>."))}}},{key:"createComputedDatasets",value:function(){var t=!0,e=!1,r=void 0;try{for(var n,o=this.computedData[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){n.value.compute(this.sensorData[0].data.sampleTimes,this.sensorData[0].data.values)}}catch(t){e=!0,r=t}finally{try{t||null==o.return||o.return()}finally{if(e)throw r}}}},{key:"parseChildren",value:function(){var t=this;this.baseNode.querySelectorAll(".computed").forEach((function(e,r){t.computedData.push(new St(r,e))}))}},{key:"stringifySensorIds",value:function(){return this.plotConfig.x.concat(this.plotConfig.y).join(",")}}]),e}(dt),l()(Ft.prototype,"download",[u],Object.getOwnPropertyDescriptor(Ft.prototype,"download"),Ft.prototype),l()(Ft.prototype,"cbkZoom",[u],Object.getOwnPropertyDescriptor(Ft.prototype,"cbkZoom"),Ft.prototype),l()(Ft.prototype,"loadLocation",[u],Object.getOwnPropertyDescriptor(Ft.prototype,"loadLocation"),Ft.prototype),Ft),Vt=(jt=function(){function t(e,r){o()(this,t),this.ds=e,this.bufferTime=y(r,"bufferTime",2e3),this.data=[],this.next=[],this.duration=0,this.pos=0,this.nextStartPos=0,this.timePerSample=0,this.retryDelay=0,this.doStall=!1,this.isWaitingNextData=!1}return i()(t,[{key:"nextSample",value:function(){var t=this.data.length;if(this.pos<this.data[0].length){for(var e=new Array(t),r=0;r<t;r++)e[r]=this.data[r][this.pos];return this.pos++,e}if(!(this.next.length>0))return this.isWaitingNextData?null:(console.warn("Forcing a bufferTime increase to avoid drowning."),this.bufferTime+=1e3,this.scheduleNextPoll(this.bufferTime),null);this.data=this.next.slice(),this.next=[],this.pos=this.nextStartPos,this.nextStartPos=0;var n=this.data[0].length;this.duration=this.data[0][n-1].x-this.data[0][this.pos].x,this.timePerSample=this.duration/n,this.duration<2*this.bufferTime&&(this.doStall=!0),this.scheduleNextPoll(this.duration-this.bufferTime)}},{key:"start",value:function(){var t=this;return new Promise((function(e,r){t.ds.download().then((function(n){0!=n[0].data.values.length?(t.data=new Array(n.length),t.next=new Array(n.length),t.storeData(n,"current"),t.scheduleNextPoll(t.duration-t.bufferTime),e(n)):1==t.ds.sensorIds.length?r(new Error("No recent data found for the sensor ".concat(t.ds.sensorIds[0],"."))):r(new Error("No recent data found for the sensors: ".concat(t.ds.sensorIds.join(","),".")))}),(function(t){return r(t)}))}))}},{key:"requestNextData",value:function(){var t=this;this.ds.refreshDateRangeFilters(),this.ds.download(!1).then((function(e){t.storeData(e,"next");for(var r=0,n=t.data[0],o=n[n.length-1].x;t.next[0][r].x<=o;)r++;t.nextStartPos=r,t.isWaitingNextData=!1}),(function(e){t.scheduleNextPoll(null)}))}},{key:"storeData",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"current",r=0;r<t.length;r++){var n=t[r].data,o=n.sampleTimes.length;if("current"==e){var a=n.sampleTimes[0],i=n.sampleTimes[o-1];this.duration=Date.parse(i)-Date.parse(a),this.timePerSample=this.duration/o,this.data[r]=new Array(o);for(var s=0;s<o;s++)this.data[r][s]={x:Date.parse(n.sampleTimes[s]),y:n.values[s]}}else{this.next[r]=new Array(o);for(var l=0;l<o;l++)this.next[r][l]={x:Date.parse(n.sampleTimes[l]),y:n.values[l]}}}}},{key:"getMaxValue",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=-9999999;if(this.data[t].length>0)for(var r=0;r<this.data[t].length;r++)this.data[t][r].y>e&&(e=this.data[t][r].y);if(this.next[t].length>0)for(var n=0;n<this.next[t].length;n++)this.next[t][n].y>e&&(e=this.next[t][n].y);return e}},{key:"getMinValue",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=99999999;if(this.data[t].length>0)for(var r=0;r<this.data[t].length;r++)this.data[t][r].y<e&&(e=this.data[t][r].y);if(this.next[t].length>0)for(var n=0;n<this.next[t].length;n++)this.next[t][n].y<e&&(e=this.next[t][n].y);return e}},{key:"getFirstTS",value:function(){return this.data.length>0&&this.data[0].length>0?this.data[0][0].x:null}},{key:"estimateValueWidth",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=5;if(this.data[e].length>0)for(var n=0;n<this.data[e].length;n++)(t="".concat(this.data[e][n].y)).length>r&&(r=t.length);return r}},{key:"scheduleNextPoll",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null==t?(t=this.retryDelay,this.retryDelay+=1e3):t<0&&(t=0),this.doStall&&(console.warn("Stalling delay ".concat(t," with extra ").concat(this.bufferTime," ms")),t+=this.bufferTime,this.doStall=!1),setTimeout(this.requestNextData,t),this.isWaitingNextData=!0}},{key:"getMetadata",value:function(){for(var t=this.ds.data.length,e=new Array(t),r=0;r<t;r++)e[r]={id:this.ds.data[r].id,sensorName:this.ds.data[r].sensorName,unitOfMeasure:this.ds.data[r].unitOfMeasure};return e}}]),t}(),l()(jt.prototype,"nextSample",[u],Object.getOwnPropertyDescriptor(jt.prototype,"nextSample"),jt.prototype),l()(jt.prototype,"start",[u],Object.getOwnPropertyDescriptor(jt.prototype,"start"),jt.prototype),l()(jt.prototype,"requestNextData",[u],Object.getOwnPropertyDescriptor(jt.prototype,"requestNextData"),jt.prototype),jt),Zt=function(){function t(e,r,n,a){o()(this,t),this.domNode=r,this.name=e,this.options=n,this.rts=a,this.CDN="",this.vendorURL="",this.colors=[],this.colorDefaults=Tt(12);var i=y(n,"min",null),s=y(n,"max",null);this.minValue=i?W(i,";"):null,this.maxValue=s?W(s,";"):null,this.parseColors()}return i()(t,[{key:"parseColors",value:function(){this.colors=this.colorDefaults;var t=this.getOption("colors",null);if(t){var e=t.split(";");if(e)for(var r=0;r<e.length;r++)this.colors[r]=e[r];else this.colors[0]=t}}},{key:"getOption",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return y(this.options,t,e)}},{key:"errorUnavailable",value:function(){return new Error('<p>The real time engine <b>"'.concat(this.name,'"</b> is unavailable.</p>\n\t\t<p>You can add this library as a <em>&lt;script&gt;</em> with the <em>src</em>: <a href="').concat(this.CDN,'" target="_BLANK">').concat(this.CDN,'</a></p>\n\t\t<p>You can also obtain the original library at <a href="').concat(this.vendorURL,'" target="_BLANK">').concat(this.vendorURL,"</a>.</p>"))}}]),t}(),Xt=(At=function(t){function e(t,r,n){var a;return o()(this,e),(a=w()(this,x()(e).call(this,"smoothie",t,r,n))).CDN="http://onc.danycabrera.com/engines/smoothie.min.js",a.vendorURL="http://smoothiecharts.org",a.line=null,a.smoothie=null,a.layout={},a.options={decimals:a.getOption("decimals",3),delay:a.getOption("delay",1e3),bufferTime:a.getOption("bufferTime",2e3),speed:a.getOption("speed",50)},a}return C()(e,t),i()(e,[{key:"prepareLayout",value:function(){this.layout={millisPerPixel:this.options.speed,interpolation:"linear",grid:{fillStyle:"#ffffff",strokeStyle:"#d0d0d0",sharpLines:!0,borderVisible:!1,verticalSections:4,millisPerLine:5e3},labels:{fillStyle:"#333",precision:this.options.decimals,showIntermediateLabels:!0,intermediateLabelSameAxis:!0},tooltip:!0,responsive:!0,nonRealtimeData:!1}}},{key:"render",value:function(){var t=this;this.line=new TimeSeries;var e=this.rts.getMaxValue(),r=this.rts.getMinValue();this.line.maxValue=1.1*r,this.line.minValue=1.1*e;var n=document.createElement("canvas");n.height="100",this.domNode.appendChild(n),this.smoothie=new SmoothieChart(this.layout),this.smoothie.streamTo(n,this.options.delay),this.smoothie.addTimeSeries(this.line,{lineWidth:2,strokeStyle:this.colors[0]}),setInterval((function(){var e=t.rts.nextSample();e&&t.line.append(Date.now(),e[1])}),this.rts.timePerSample)}},{key:"isEngineAvailable",value:function(){return!("undefined"==typeof SmoothieChart)}}]),e}(Zt),l()(At.prototype,"render",[u],Object.getOwnPropertyDescriptor(At.prototype,"render"),At.prototype),At),Gt=(It=function(t){function e(t,r,n){var a;return o()(this,e),(a=w()(this,x()(e).call(this,"chartjs",t,r,n))).CDN="http://onc.danycabrera.com/engines/chartjs.min.js",a.vendorURL="https://www.chartjs.org",a.chart=null,a.layout={},a.dataInfo=[],a.domValueBlocks=[],a.options={decimals:a.getOption("decimals",3),delay:a.getOption("delay",1e3),bufferTime:a.getOption("bufferTime",2e3),speed:a.getOption("speed",2e4)},a}return C()(e,t),i()(e,[{key:"prepareLayout",value:function(){this.dataInfo=this.rts.getMetadata();for(var t=this.dataInfo,e=Date.now()-this.rts.getFirstTS(),r=[],n=[],o=0;o<t.length;o++){var a="".concat(t[o].sensorName," [").concat(t[o].unitOfMeasure,"]");r.push({label:a,data:[],borderColor:this.colors[o],backgroundColor:this.colors[o],fill:!1,yAxisID:"y-axis-".concat(o)});var i={display:!0,type:"linear",scaleLabel:{display:!0,labelString:a,fontColor:this.colors[o]},ticks:{fontColor:this.colors[o]},position:o%2==0?"left":"right",id:"y-axis-".concat(o),gridLines:{drawOnChartArea:!1}};this.minValue&&(i.ticks.min=+this.minValue[o]),this.maxValue&&(i.ticks.max=+this.maxValue[o]),n.push(i)}n[0].gridlines={},this.layout={type:"line",data:{datasets:r},options:{responsive:!0,scales:{xAxes:[{type:"realtime",realtime:{duration:this.options.speed,refresh:this.rts.timePerSample,onRefresh:this.addSample,delay:e+this.options.delay}}],yAxes:n},tooltips:{mode:"nearest",intersect:!1},hover:{mode:"nearest",intersect:!1},legend:{display:!1}}}}},{key:"addSample",value:function(){var t=this.rts.nextSample();if(t)for(var e=0;e<t.length;e++)this.chart.data.datasets[e].data.push(t[e]),this.domValueBlocks[e].innerHTML=t[e].y}},{key:"render",value:function(){var t=document.createElement("div");t.classList.add("legend");for(var e=this.dataInfo,r=[],n=0;n<e.length;n++)r.push('<span class="value idx_'.concat(n,'" style="background: ').concat(this.colors[n],'"></span> ').concat(e[n].sensorName," [").concat(e[n].unitOfMeasure,"]"));t.innerHTML="<ul>"+$(r,"li")+"</ul>",this.domNode.appendChild(t);for(var o=0;o<e.length;o++)this.domValueBlocks.push(t.querySelector("span.idx_"+o)),this.domValueBlocks[o].style.width=6*this.rts.estimateValueWidth(o)+16+"px";var a=document.createElement("canvas"),i=a.getContext("2d");this.domNode.appendChild(a),this.chart=new Chart(i,this.layout)}},{key:"isEngineAvailable",value:function(){return!("undefined"==typeof Chart)}}]),e}(Zt),l()(It.prototype,"addSample",[u],Object.getOwnPropertyDescriptor(It.prototype,"addSample"),It.prototype),l()(It.prototype,"render",[u],Object.getOwnPropertyDescriptor(It.prototype,"render"),It.prototype),It),Kt=(Nt=function(t){function e(t,r){var n;switch(o()(this,e),(n=w()(this,x()(e).call(this,t,r))).engine=null,""==n.source&&(n.source="scalardata"),n.source){case"plottingUtility":n.ds=new ct(n._onc,n.filters,n.showLoader);break;case"scalardata":n.ds=new Ot(n._onc,n.filters,n.showLoader);break;default:throw new Error('Unrecognized data source for this plot widget: <b>"'.concat(n.source,'"</b>.'))}n.ds.userDates=n.parser.userDates;var a=n.options.engine;switch(n.rts=new Vt(n.ds,a),null!=a.name&&""!=a.name||(a.name="smoothie"),n.options.engine.name){case"smoothie":n.engine=new Xt(n.dom.content,a,n.rts);break;case"chartjs":n.engine=new Gt(n.dom.content,a,n.rts)}if(!n.engine.isEngineAvailable())throw n.engine.errorUnavailable();return n.ds.addPerformanceMsg("<b>Render engine:</b> ".concat(n.engine.name)),n.dom.base.classList.add("eng_"+n.engine.name),n}return C()(e,t),i()(e,[{key:"download",value:function(){var t=this;return nt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){t.rts.start().then((function(r){t.engine.prepareLayout(),t.loaderIsVisible=!1,e(r)}),(function(t){return r(t)}))})));case 1:case"end":return e.stop()}}))}},{key:"renderContents",value:function(){this.ds.hasData()?(this.statusBox.remove(),this.engine.render()):this.showStatus("info","No sensor data found for the filters specified.")}}]),e}(dt),l()(Nt.prototype,"download",[u],Object.getOwnPropertyDescriptor(Nt.prototype,"download"),Nt.prototype),Nt),Jt=(qt=function(t){function e(t,r,n){var a,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return o()(this,e),(a=w()(this,x()(e).call(this,"dataProductDelivery")))._onc=t,a.filters=r,a.storeProduct=i,a.dpRequestId=0,a.dpRunId=0,a.pollCount=0,a.fileCount=0,a.payloadSize=0,a.contentTypes=[],a.downloadURLs=[],a.autocompleteFilters(),a.cbkShowLoader=n,a}return C()(e,t),i()(e,[{key:"autocompleteFilters",value:function(){var t=this.filters.dataProductCode,e=this.filters.extension;"TSSP"==t&&"png"==e&&function(t,e){if(t){var r=Object.keys(t);for(var n in r)e[r[n]]=t[r[n]]}}({dpo_qualityControl:1,dpo_resample:"none"},this.filters)}},{key:"download",value:function(){var t=this;return this.data=[],this.logDownloadStart(),this.cbkShowLoader("loading","Requesting data product"),new Promise((function(e,r){var n,o;return nt.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(!t.cancelled){a.next=3;break}return r("cancelled"),a.abrupt("return");case 3:return a.prev=3,a.next=6,nt.a.awrap(t._onc.productRequest(t.filters));case 6:if(n=a.sent,!t.cancelled){a.next=9;break}throw"cancelled";case 9:t.cbkShowLoader("waiting","Waiting for data product"),t.dpRequestId=n.data.dpRequestId,t.saveRequestURL(n),o=0;case 13:if(200==o){a.next=21;break}return a.next=16,nt.a.awrap(t.run());case 16:if(o=a.sent,!t.cancelled){a.next=19;break}throw"cancelled";case 19:a.next=13;break;case 21:if(t.addDownloadURLs(),!t.storeProduct){a.next=29;break}if(!(t.fileCount>0)){a.next=28;break}return a.next=26,nt.a.awrap(t.downloadFileBlobs());case 26:a.next=29;break;case 28:throw"empty";case 29:t.logDownloadEnd(),e(),a.next=38;break;case 33:return a.prev=33,a.t0=a.catch(3),a.t0.response&&t.saveRequestURL(a.t0.response),r(a.t0),a.abrupt("return");case 38:case"end":return a.stop()}}),null,null,[[3,33]])}))}},{key:"run",value:function(){var t;return nt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt.a.awrap(this._onc.productRun({dpRequestId:this.dpRequestId}));case 2:return t=e.sent,0==this.pollCount&&this.saveRequestURL(t),this.pollCount++,200==t.status?(this.dpRunId=t.data[0].dpRunId,this.fileCount=t.data[0].fileCount,this.cbkShowLoader("downloading","Downloading ".concat(this.fileCount," files"))):this.cbkShowLoader("waiting","(".concat(t.statusText,") ").concat(t.data[0].status)),e.abrupt("return",t.status);case 7:case"end":return e.stop()}}),null,this)}},{key:"requestStatus",value:function(){var t;return nt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt.a.awrap(this._onc.productStatus({dpRequestId:this.dpRequestId}));case 2:return t=e.sent,this.pollCount++,this.onRunEnd&&this.onRunEnd(t),e.abrupt("return",202);case 6:case"end":return e.stop()}}),null,this)}},{key:"downloadFileBlobs",value:function(){var t,e;return nt.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:t=1;case 1:if(!(t<=this.fileCount)){r.next=9;break}return r.next=4,nt.a.awrap(this._onc.productDownload({dpRunId:this.dpRunId,index:t}));case 4:200==(e=r.sent).status&&(this.saveRequestURL(e),this.data.push(e.data),this.payloadSize+=e.data.length,this.contentTypes.push(e.headers["content-type"]));case 6:t++,r.next=1;break;case 9:case"end":return r.stop()}}),null,this)}},{key:"addDownloadURLs",value:function(){for(var t=1;t<=this.fileCount;t++)this.downloadURLs.push(this._onc.getProductDownloadURL(this.dpRunId,t))}},{key:"saveRequestURL",value:function(t){var e=t.request.responseURL;this._onc.useProxy&&(e=t.config.headers["X-Proxy-Url"]+e.substr(t.config.url.length)),this.requestURLs.push(e)}}]),e}(at),l()(qt.prototype,"download",[u],Object.getOwnPropertyDescriptor(qt.prototype,"download"),qt.prototype),qt),Qt=function(t){function e(t,r){var n;return o()(this,e),(n=w()(this,x()(e).call(this,"quickPlot"))).filters=t,n.baseUrl="https://data.oceannetworks.ca/Plot",n.fileCount=0,n.cbkShowLoader=r,n}return C()(e,t),i()(e,[{key:"download",value:function(){var t=this;return this.data=[],new Promise((function(e,r){var n,o,a;return nt.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:if(!t.cancelled){i.next=3;break}return r("cancelled"),i.abrupt("return");case 3:n="on"==t.filters.plotTitle?"on":"off",o={sensorId:t.filters.sensorId,datefrom:S.a.utc(t.filters.dateFrom).format("DD-MMM-YYYY HH:mm:ss"),dateto:S.a.utc(t.filters.dateTo).format("DD-MMM-YYYY HH:mm:ss"),plotwidth:320,plotheight:240,plottitle:n},(a=Object.assign({},o)).plotwidth=800,a.plotheight=600,t.data.push({thumb:t.baseUrl+"?"+t.stringifyFilters(o),url:t.baseUrl+"?"+t.stringifyFilters(a)}),t.fileCount++,e();case 11:case"end":return i.stop()}}))}))}},{key:"stringifyFilters",value:function(t){for(var e="",r=0,n=Object.keys(t);r<n.length;r++){var o=n[r];e.length>0&&(e+="&"),e+="".concat(o,"=").concat(encodeURI(t[o]))}return e}}]),e}(at),te=(Ut=function(t){function e(t,r){var n;return o()(this,e),(n=w()(this,x()(e).call(this,"dataPreview"))).filters=t,n.baseUrl="https://data.oceannetworks.ca/DataPreviewService",n._axios=f.a.create({method:"get",baseURL:n.baseUrl,timeout:12e4}),n.downloadURLs=[],n.fileCount=0,n.cbkShowLoader=r,n}return C()(e,t),i()(e,[{key:"download",value:function(){var t=this;this.downloadURLs=[],this.parseUrl(this.filters),this.parseRange(this.filters);var e={url:this.baseUrl,params:this.params};return new Promise((function(r,n){t._axios.request(e).then((function(e){if(0===e.data.length&&n("empty"),!e.data.payload.filePath)return n({message:"No data preview image could be found matching the parameters."});var o=e.data.payload.filePath;t.downloadURLs.push(o),t.fileCount++,r(o)}),(function(t){n(t)}))}))}},{key:"parseUrl",value:function(t){if(t.url){var e=t.url.split("?")[1].split("&"),r={},n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var l=i.value.split("=");r[l[0]]=l[1]}}catch(t){o=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}this.params={operation:y(r,"operation",10),searchTreeNodeId:y(r,"searchTreeNodeId",0),deviceCategoryId:y(r,"deviceCategoryId",0),timeConfigId:y(r,"timeConfigId",1),dataProductFormatId:y(r,"dataProductFormatId",3),plotNumber:y(r,"plotNumber",1)}}}},{key:"parseRange",value:function(t){if(t.range){var e=t.range;this.params.timeConfigId="last1y"==e||"last12M"==e?4:"last30d"==e||"last4w"==e||"last1M"==e?3:"last7d"==e||"last1w"==e?2:1}}}]),e}(at),l()(Ut.prototype,"download",[u],Object.getOwnPropertyDescriptor(Ut.prototype,"download"),Ut.prototype),Ut);r(62);var ee,re,ne,oe=function(t){function e(t,r){var n;if(o()(this,e),(n=w()(this,x()(e).call(this,t,r))).cancelled)return w()(n);switch(n.source){case"quickPlot":n.ds=new Qt(n.filters,n.showLoader);break;case"dataProductDelivery":n.ds=new Jt(n._onc,n.filters,n.showLoader);break;case"dataPreview":n.ds=new te(n.filters,n.showLoader);break;default:throw'Invalid data source: "'.concat(n.source,'"')}return n}return C()(e,t),i()(e,[{key:"download",value:function(){var t=this;return new Promise((function(e,r){t.ds.download().then((function(t){e(t)}),(function(t){return r(t)}))}))}},{key:"renderContents",value:function(){var t=this.ds.fileCount;if(0!=t){this.showLoader("downloading","Downloading..."),this.ds.addPerformanceMsg("Payload size does not include the images downloaded by this widget.");for(var e=0;e<t;e++)this.renderImage(e)}}},{key:"renderImage",value:function(t){var e="",r="";switch(this.source){case"quickPlot":e=this.ds.data[t].url,r=this.ds.data[t].thumb;break;case"dataProductDelivery":case"dataPreview":e=this.ds.downloadURLs[t],r=this.ds.downloadURLs[t]}switch(this.ds.addRequestURL(e),this.options.theme){case"default":this.theme_default(e);break;case"plain":this.theme_plain(e);break;case"gallery":this.theme_gallery(e,r)}}},{key:"theme_default",value:function(t){var e=this,r=new Image;r.onload=function(){return e.statusBox.remove()},r.src=t,r.classList.add("oncImage"),this.dom.content.appendChild(r)}},{key:"theme_plain",value:function(t){var e=this,r=new Image;r.onload=function(){return e.statusBox.remove()},r.onerror=function(){e.statusBox.remove(),e.showStatus("error","Failed to download image")},r.src=t,this.dom.content.appendChild(r)}},{key:"theme_gallery",value:function(t,e){var r=this,n=document.createElement("div");n.classList.add("thumb");var o=document.createElement("div");o.className="oncBackdrop",o.innerHTML='<span class="btClose" onclick="this.parentNode.click()">&otimes;</span><img src="'.concat(t,'">'),o.onclick=function(t){t.target.className.includes("oncBackdrop")&&this.classList.remove("active")},n.appendChild(o);var a=new Image;a.onload=function(){return r.statusBox.remove()},a.onerror=function(t){r.statusBox.remove(),r.showStatus("error","Failed to download image")},a.src=e,a.className="oncImageThumb",a.onclick=function(){var t=this.parentNode.querySelector("div.oncBackdrop");t.classList.add("active");var e=t.querySelector("img");""==e.className?(wheelzoom(e),e.className="zoomable",e.onmouseup="event.stopPropagation()"):e.dispatchEvent(new Event("wheelzoom.reset"))},n.appendChild(a),this.dom.content.appendChild(n)}}]),e}(dt),ae=function(t){function e(t,r){var n;return o()(this,e),(n=w()(this,x()(e).call(this,t,r))).ds=new Jt(n._onc,n.filters,n.showLoader),n}return C()(e,t),i()(e,[{key:"download",value:function(){var t=this;return nt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){t.ds.download().then((function(t){e(t)}),(function(t){return r(t)}))})));case 1:case"end":return e.stop()}}))}},{key:"renderContents",value:function(){var t=this.ds.fileCount;if(0!=t){this.statusBox.remove();for(var e=[],r="",n="",o=0;o<t;o++)r=this.ds.downloadURLs[o],n=this.filters.extension,e.push('<a href="'.concat(r,'">Data product ').concat(o+1," (").concat(n,")</a>"));this.domNode.innerHTML='<ul class="download">'.concat($(e,"li"),"</ul>")}}}]),e}(dt),ie=function(t){function e(t,r,n){var a;return o()(this,e),(a=w()(this,x()(e).call(this,"rawdata")))._onc=t,a.filters=r,a.cbkShowLoader=n,a}return C()(e,t),i()(e,[{key:"download",value:function(){var t=this;return new Promise((function(e,r){t.filters.dateFrom||t.filters.dateTo||(t.filters.dateFrom="-P0Y0M0DT0H1M0S",t.filters.rowLimit="3",t.filters.getLatest=!0),t._onc.getRawData(t.filters).then((function(r){t.data=r.data.data,e(t.data)}),(function(t){r(t)}))}))}}]),e}(at),se=(ee=function(t){function e(t,r){var n;o()(this,e),(n=w()(this,x()(e).call(this,t,r))).delay=y(n.options,"delay",2e3),n.maxLogRows=y(n.options,"maxLogRows","100"),n.formatter=null;var a=y(n.options,"formatter","");return""!=a&&void 0!==window[a]&&(n.formatter=window[a]),n.ds=new ie(n._onc,n.filters,n.showLoader),n.logCount=0,n}return C()(e,t),i()(e,[{key:"download",value:function(){var t=this;return new Promise((function(e,r){t.ds.download().then((function(n){t.ds.data&&t.ds.data.length>0?(setTimeout(t.requestData,t.delay),e(n)):r(new Error("No recent data found for the filters provided."))}),(function(t){return r(t)}))}))}},{key:"requestData",value:function(){var t=this;this.ds.download().then((function(e){t.displayData(t.ds.data),setTimeout(t.requestData,t.delay)}),(function(t){console.log(t)}))}},{key:"displayData",value:function(t){this.domNode.querySelector("tr.dataRow").innerHTML=this.renderElement(t[0]);var e=this.formatter?this.formatter(t[0].rawData):t[0].rawData,r=this.domNode.querySelector("tr.logRow ul"),n=document.createElement(n);n.innerHTML="<li>".concat(t[0].sampleTime," ").concat(e,"</li>"),r.prepend(n),this.logCount++,this.logCount>this.maxLogRows&&r.removeChild(r.lastElementChild)}},{key:"renderContents",value:function(){var t="";t+='<tr class="dataRow console">'+this.renderElement(this.ds.data[0])+"</tr>",t+='<tr class="logRow"><td colspan="4"><ul></ul></td></tr>',this.domNode.innerHTML=H(["Date","Time","Line Type","Data"],t)}},{key:"renderElement",value:function(t){var e=t.sampleTime.split("T"),r=e[0],n=e[1].substr(0,e[1].length-1),o=t.rawData;return this.formatter&&(o=this.formatter(o)),$([r,n,'"'+t.lineType+'"',o],"td",",,center,")}}]),e}(dt),l()(ee.prototype,"requestData",[u],Object.getOwnPropertyDescriptor(ee.prototype,"requestData"),ee.prototype),l()(ee.prototype,"displayData",[u],Object.getOwnPropertyDescriptor(ee.prototype,"displayData"),ee.prototype),ee),le=(re=function(t){function e(t,r,n){var a;return o()(this,e),(a=w()(this,x()(e).call(this,"archivefiles")))._onc=t,a.filters=Object.assign({},r),a.extension=[],a.origin=a.originType(),a.single=!0,a.parseDates=!1,a.parseExtension=!0,a.parseOrigins(),a.filters.extension&&(a.extension=W(a.filters.extension),delete a.filters.extension),a.cbkShowLoader=n,a}return C()(e,t),i()(e,[{key:"download",value:function(){var t=this;return nt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return this.cbkShowLoader("loading","Requesting archive files"),e.abrupt("return",new Promise((function(e,r){var n,o,a,i,s,l,c,u,d,h,p,f,y,v;return nt.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t.single){r.next=7;break}return r.next=3,nt.a.awrap(t.downloadElement(t.filters));case 3:t.data=r.sent,e(t.data),r.next=72;break;case 7:if(t.data=[],"device"!=t.origin){r.next=41;break}a=!0,i=!1,s=void 0,r.prev=12,l=t.filters.deviceCode[Symbol.iterator]();case 14:if(a=(c=l.next()).done){r.next=25;break}return u=c.value,(n=Object.assign({},t.filters)).deviceCode=u,r.next=20,nt.a.awrap(t.downloadElement(n));case 20:o=r.sent,t.data.push({deviceCode:u,files:o});case 22:a=!0,r.next=14;break;case 25:r.next=31;break;case 27:r.prev=27,r.t0=r.catch(12),i=!0,s=r.t0;case 31:r.prev=31,r.prev=32,a||null==l.return||l.return();case 34:if(r.prev=34,!i){r.next=37;break}throw s;case 37:return r.finish(34);case 38:return r.finish(31);case 39:r.next=72;break;case 41:if("location"!=t.origin){r.next=72;break}d=!0,h=!1,p=void 0,r.prev=45,f=t.filters.locationCode[Symbol.iterator]();case 47:if(d=(y=f.next()).done){r.next=58;break}return v=y.value,(n=Object.assign({},t.filters)).locationCode=v,r.next=53,nt.a.awrap(t.downloadElement(n));case 53:o=r.sent,t.data.push({locationCode:v,files:o});case 55:d=!0,r.next=47;break;case 58:r.next=64;break;case 60:r.prev=60,r.t1=r.catch(45),h=!0,p=r.t1;case 64:r.prev=64,r.prev=65,d||null==f.return||f.return();case 67:if(r.prev=67,!h){r.next=70;break}throw p;case 70:return r.finish(67);case 71:return r.finish(64);case 72:e(t.data);case 73:case"end":return r.stop()}}),null,null,[[12,27,31,39],[32,,34,38],[45,60,64,72],[65,,67,71]])}),(function(t){reject(t)})));case 2:case"end":return e.stop()}}),null,this)}},{key:"downloadElement",value:function(t){var e=this;return new Promise((function(r,n){e._onc.getArchiveFileList(t).then((function(t){var n=Array(),o=e.parseExtension;if(e.extension.length>0)for(var a,i="",s=0;s<t.data.files.length;s++)i=Z((a=t.data.files[s]).filename),e.extension.includes(i)&&(e.parseDates&&(a.dateFrom=S()(a.dateFrom).utc().valueOf(),a.dateTo=S()(a.dateTo).utc().valueOf()),o&&(a.extension=i),n.push(a));else if(n=t.data.files,e.parseDates)for(var l=0;l<n.length;l++)n[l].dateFrom=S()(n[l].dateFrom).utc().valueOf(),n[l].dateTo=S()(n[l].dateTo).utc().valueOf(),o&&(n[l].extension=Z(n[l].filename));r(n)}),(function(t){n(t)}))}))}},{key:"originType",value:function(){return this.filters.deviceCode?"device":"location"}},{key:"parseOrigins",value:function(){this.single=!0,"device"==this.origin&&this.filters.deviceCode.indexOf(",")>=0&&(this.filters.deviceCode=W(this.filters.deviceCode),this.single=!1),"location"==this.origin&&this.filters.locationCode.indexOf(",")>=0&&(this.filters.locationCode=W(this.filters.locationCode),this.single=!1)}}]),e}(at),l()(re.prototype,"download",[u],Object.getOwnPropertyDescriptor(re.prototype,"download"),re.prototype),l()(re.prototype,"downloadElement",[u],Object.getOwnPropertyDescriptor(re.prototype,"downloadElement"),re.prototype),re);S.a.extend(L.a);var ce,ue,de=(ne=function(t){function e(t,r){var n;return o()(this,e),(n=w()(this,x()(e).call(this,t,r))).filters.returnOptions="all",n.variant=n.getOption("variant","default"),n.ds=new le(r,n.filters,n.showLoader),n}return C()(e,t),i()(e,[{key:"download",value:function(){return this.ds.download()}},{key:"renderContents",value:function(){if(this.ds.hasData())switch(this.variant){case"default":this.renderDefault();break;case"summary":this.renderSummary();break;default:throw Error('invalid variant: "'.concat(this.variant,'"'))}else this.showStatus("info","No data found for the filters provided.")}},{key:"renderSummary",value:function(){var t=[],e=[],r="",n="",o=!0,a=!1,i=void 0;try{for(var s,l=this.ds.data[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var c=s.value;if(r=Z(c.filename),n="".concat(c.dataProductCode,".").concat(r),e.includes(n)){t[n].count++;var u=S()(c.dateFrom).utc(),d=S()(c.dateTo).utc();u<t[n].dateFrom&&(t[n].dateFrom=u),d>t[n].dateTo&&(t[n].dateTo=d),t[n].size+=c.uncompressedFileSize}else t[n]={count:1,dateFrom:S()(c.dateFrom).utc(),dateTo:S()(c.dateTo).utc(),size:c.uncompressedFileSize,extension:r,dataProductCode:c.dataProductCode},e.push(n)}}catch(t){a=!0,i=t}finally{try{o||null==l.return||l.return()}finally{if(a)throw i}}var h="";for(var p in t)h+="<tr>".concat(this.renderDpSummary(p,t[p]),"</tr>");this.dom.content.innerHTML=H(["DP Code","Extension","Count","From (min)","To (max)","File size (total)"],h)}},{key:"renderDpSummary",value:function(t,e){var r=R(e.dateFrom,"YYYY-MM-DD HH:mm:ss"),n=R(e.dateTo,"YYYY-MM-DD HH:mm:ss");return $([e.dataProductCode,e.extension,e.count,r,n,V(e.size)],"td")}},{key:"renderDefault",value:function(){var t="",e=!0,r=!1,n=void 0;try{for(var o,a=this.ds.data[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var i=o.value;t+="<tr>"+this.renderArchiveInfo(i)+"</tr>"}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}this.dom.content.innerHTML=H(["DP Code","Filename","From","To","File size"],t)}},{key:"renderArchiveInfo",value:function(t){var e="https://data.oceannetworks.ca/api/archivefiles?method=getFile&token=".concat(this._onc.token,"&filename=").concat(t.filename),r='<a target="_blank" href="'.concat(e,'">').concat(t.filename,"</a>"),n=R(t.dateFrom,"YYYY-MM-DD HH:mm:ss"),o=R(t.dateTo,"YYYY-MM-DD HH:mm:ss"),a=V(t.uncompressedFileSize);return $([t.dataProductCode,r,n,o,a],"td")}}]),e}(dt),l()(ne.prototype,"download",[u],Object.getOwnPropertyDescriptor(ne.prototype,"download"),ne.prototype),l()(ne.prototype,"renderContents",[u],Object.getOwnPropertyDescriptor(ne.prototype,"renderContents"),ne.prototype),ne),he=(ce=function(t){function e(t,r){var n;return o()(this,e),(n=w()(this,x()(e).call(this,t,r))).widgetW=n.getOption("width"),n.widgetH=n.getOption("height"),n.domPager=null,n.images=[],n.f=0,n.interval=null,n.count=0,n.period=n.getOption("delay",500),n.filters.returnOptions="all",n.ds=new le(r,n.filters,n.showLoader),n}return C()(e,t),i()(e,[{key:"download",value:function(){return this.ds.download()}},{key:"renderContents",value:function(){var t=this;this.count=this.ds.data.length;var e=[],r=!0,n=!1,o=void 0;try{for(var a,i=this.ds.data[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value;e.push("https://data.oceannetworks.ca/api/archivefiles?method=getFile&token=".concat(this._onc.token,"&filename=").concat(s.filename))}}catch(t){n=!0,o=t}finally{try{r||null==i.return||i.return()}finally{if(n)throw o}}var l=this.count,c=new Image;this.images.push(c);var u=document.createElement("div");u.classList.add("imgGif"),u.appendChild(c),c.onload=function(){if(t.statusBox.remove(),c.classList.add("fadeIn"),t.widgetW&&t.widgetH)u.style.width="".concat(t.widgetW),u.style.height="".concat(t.widgetH);else if(t.widgetW||t.widgetH){var r=c.naturalHeight/c.naturalWidth;t.widgetW?(u.style.width="".concat(t.widgetW,"px"),u.style.height="".concat(t.widgetW*r,"px")):(u.style.height="".concat(t.widgetH,"px"),u.style.width="".concat(t.widgetH/r,"px"))}else u.style.width="".concat(c.naturalWidth,"px"),u.style.height="".concat(c.naturalHeight,"px");for(var n=1;n<l;n++){var o=new Image;o.src=e[n],t.images.push(o),u.appendChild(o)}t.start()},c.src=e[0],this.dom.content.appendChild(u),this.dom.content.appendChild(this.renderPagination())}},{key:"renderPagination",value:function(){var t=this,e=document.createElement("div");e.classList.add("controls"),e.addEventListener("mouseleave",(function(e){t.start()}));var r=document.createElement("button");r.classList.add("btPrev"),r.onclick=this.cbkBtPrevClick;var n=document.createElement("button");return n.classList.add("btNext"),n.onclick=this.cbkBtNextClick,e.appendChild(r),e.appendChild(n),this.domPager=document.createElement("div"),this.domPager.classList.add("txtPager"),e.appendChild(this.domPager),this.updatePager(),e}},{key:"cbkBtPrevClick",value:function(){this.stop(),this.fadeToPrev()}},{key:"cbkBtNextClick",value:function(){this.stop(),this.fadeToNext()}},{key:"hideFrame",value:function(t){this.images[t].classList.add("fadeOut"),this.images[t].classList.remove("fadeIn"),this.images[t].classList.remove("visible")}},{key:"showFrame",value:function(t){this.images[t].classList.remove("fadeOut"),this.images[t].classList.add("visible")}},{key:"stop",value:function(){clearInterval(this.interval),this.interval=null}},{key:"start",value:function(){null==this.interval&&(this.interval=setInterval(this.fadeToNext,this.period))}},{key:"updatePager",value:function(){this.domPager.innerHTML="".concat(this.f+1," of ").concat(this.count)}},{key:"fadeToFrame",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.hideFrame(this.f),this.showFrame(t),this.f=t,this.updatePager()}},{key:"fadeToNext",value:function(){this.fadeToFrame(this.getNextFrame())}},{key:"fadeToPrev",value:function(){this.fadeToFrame(this.getPrevFrame())}},{key:"getNextFrame",value:function(){var t=this.f+1;return t>=this.count?0:t}},{key:"getPrevFrame",value:function(){var t=this.f-1;return t<0?this.count-1:t}}]),e}(dt),l()(ce.prototype,"renderContents",[u],Object.getOwnPropertyDescriptor(ce.prototype,"renderContents"),ce.prototype),l()(ce.prototype,"cbkBtPrevClick",[u],Object.getOwnPropertyDescriptor(ce.prototype,"cbkBtPrevClick"),ce.prototype),l()(ce.prototype,"cbkBtNextClick",[u],Object.getOwnPropertyDescriptor(ce.prototype,"cbkBtNextClick"),ce.prototype),l()(ce.prototype,"hideFrame",[u],Object.getOwnPropertyDescriptor(ce.prototype,"hideFrame"),ce.prototype),l()(ce.prototype,"showFrame",[u],Object.getOwnPropertyDescriptor(ce.prototype,"showFrame"),ce.prototype),l()(ce.prototype,"stop",[u],Object.getOwnPropertyDescriptor(ce.prototype,"stop"),ce.prototype),l()(ce.prototype,"start",[u],Object.getOwnPropertyDescriptor(ce.prototype,"start"),ce.prototype),l()(ce.prototype,"fadeToFrame",[u],Object.getOwnPropertyDescriptor(ce.prototype,"fadeToFrame"),ce.prototype),l()(ce.prototype,"fadeToNext",[u],Object.getOwnPropertyDescriptor(ce.prototype,"fadeToNext"),ce.prototype),l()(ce.prototype,"fadeToPrev",[u],Object.getOwnPropertyDescriptor(ce.prototype,"fadeToPrev"),ce.prototype),l()(ce.prototype,"getNextFrame",[u],Object.getOwnPropertyDescriptor(ce.prototype,"getNextFrame"),ce.prototype),l()(ce.prototype,"getPrevFrame",[u],Object.getOwnPropertyDescriptor(ce.prototype,"getPrevFrame"),ce.prototype),ce);S.a.extend(L.a);var pe,fe=(ue=function(t){function e(t,r){var n;return o()(this,e),(n=w()(this,x()(e).call(this,t,r))).filters.returnOptions="all",n.ds=new le(r,n.filters,n.showLoader),n.ds.parseDates=!0,n}return C()(e,t),i()(e,[{key:"download",value:function(){return this.ds.download()}},{key:"renderContents",value:function(){if(this.ds.hasData()){var t,e=!this.ds.data[0].files,r=this.filters.deviceCode?"device":"location",n=[],o=this.buildDaysList();if(e)t=this.countFilesForRanges(o,this.ds.data),n="device"==r?[{deviceCode:this.filters.deviceCode,counts:t}]:[{locationCode:this.filters.deviceCode,counts:t}];else for(var a=0;a<this.ds.data.length;a++)t=this.countFilesForRanges(o,this.ds.data[a].files),"device"==r?n.push({deviceCode:this.ds.data[a].deviceCode,counts:t}):n.push({locationCode:this.ds.data[a].locationCode,counts:t});"device"==r?this.renderDevices(o,n):this.renderLocations(o,n)}else this.showStatus("info","No data found for the filters provided.")}},{key:"countFilesForRanges",value:function(t,e){for(var r=t.length,n=Array(r),o=0;o<r;o++)n[o]=0;for(var a=0;a<e.length;a++)for(var i=0;i<r;i++)if(e[a].dateFrom>=t[i].dateFrom&&e[a].dateFrom<=t[i].dateTo){n[i]++;break}return n}},{key:"buildDaysList",value:function(){var t=[],e=S()(this.filters.dateFrom),r=S()(this.filters.dateTo),n=(e=this.flattenDate(e)).add(1,"day");if(n>r)t.push({dateFrom:e,dateTo:r});else{for(var o=e;n<r;)t.push({dateFrom:o,dateTo:n}),o=o.add(1,"day"),n=n.add(1,"day");o<r&&t.push({dateFrom:o,dateTo:r})}return t}},{key:"flattenDate",value:function(t){return t=(t=(t=(t=t.set("h",0)).set("m",0)).set("s",0)).set("ms",0)}},{key:"renderDevices",value:function(t,e){var r=["deviceCode"],n=!0,o=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var l=i.value;r.push(l.dateFrom.format("YYYY-MM-DD"))}}catch(t){o=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}var c="",u=!0,d=!1,h=void 0;try{for(var p,f=e[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var y=p.value,v=[y.deviceCode];c+="<tr>"+$(v=v.concat(y.counts),"td")+"</tr>"}}catch(t){d=!0,h=t}finally{try{u||null==f.return||f.return()}finally{if(d)throw h}}this.dom.content.innerHTML=H(r,c)}},{key:"renderDefault",value:function(){}}]),e}(dt),l()(ue.prototype,"download",[u],Object.getOwnPropertyDescriptor(ue.prototype,"download"),ue.prototype),l()(ue.prototype,"renderContents",[u],Object.getOwnPropertyDescriptor(ue.prototype,"renderContents"),ue.prototype),ue),ye=r(22),ve=r.n(ye);function me(){Crafty.c("Legend",{e_labels:[],layout:{lblMargin:10},init:function(){this.addComponent("UI, 2D"),Crafty.c("Label",{data:null,e_box:null,e_txt:null,active:!0,init:function(){return this.addComponent("UI, 2D, Mouse").attr({h:22}),this.e_box=Crafty.e("UI, 2D"),this.e_box.attr({x:0,y:4,w:16,h:16}).css({display:"inline-block","box-sizing":"border-box"}),this.e_txt=Crafty.e("UI, 2D, Text").attr({x:20,y:6,h:16}).textFont("size","12px").textAlign("left"),this.bind("Click",this.toggle),this},Label:function(t,e,r,n){this.data=r,this.cbkToggleLabel=n;var o=this.data.colors;this.e_box.css({border:"1px solid ".concat(o.dark),"background-image":"linear-gradient(".concat(o.light,", ").concat(o.normal,")")});var a=this.getText(),i=this.getTextWidth(a,"12px Arial, Sans");return this.e_txt.text(a).attr({w:i+5}),this.w=i+22,this.attach(this.e_box,this.e_txt),this.attr({x:t,y:e}),this},toggle:function(t){this.active?(this.e_txt.alpha=.5,this.e_box.alpha=.5,this.active=!1):(this.e_txt.alpha=1,this.e_box.alpha=1,this.active=!0),this.cbkToggleLabel(this.data.key)},getText:function(){return"".concat(this.data.dataProductCode," (.").concat(this.data.extension,")")},getTextWidth:function(t,e){var r=(Crafty._canvasGetTextWidth||(Crafty._canvasGetTextWidth=document.createElement("canvas"))).getContext("2d");return r.font=e,r.measureText(t).width}}),Crafty.c("File",{file:null,dp:null,colors:{},hover:!1,active:!1,e_tooltip:null,init:function(){return this.addComponent("Canvas, 2D, Mouse").bind("MouseOver",this.cbkMouseOver).bind("MouseOut",this.cbkMouseOut).bind("MouseDown",this.cbkMouseDown).bind("MouseUp",this.cbkMouseUp).bind("Draw",this.drawFile),this.showTooltip.bind(this),this.hideTooltip.bind(this),this.drawFile.bind(this),this},File:function(t,e,r,n,o,a){return this.file=t,this.dp=e,this.colors=o,this.downloadUrl="".concat(a,"&filename=").concat(t[0]),this.attr({w:r,h:n}),this.ready=!0,this},cbkMouseOver:function(t){this.active=!1,this.hover=!0,this.z=1,this.trigger("Invalidate"),this.showTooltip(t)},cbkMouseOut:function(t){this.active=!1,this.hover=!1,this.z=0,this.trigger("Invalidate"),this.hideTooltip()},cbkMouseDown:function(t){this.active=!0,this.hideTooltip(),this.trigger("Invalidate")},cbkMouseUp:function(t){this.active=!1,this.trigger("Invalidate"),window.open(this.downloadUrl,"_blank")},drawFile:function(t){var e=this._x,r=this._y,n=this._w,o=this._h;if(this.active)t.ctx.fillStyle=this.colors.dark;else if(this.hover)t.ctx.fillStyle=this.colors.light;else{var a=t.ctx.createLinearGradient(0,r,0,r+o);a.addColorStop(0,this.colors.light),a.addColorStop(1,this.colors.normal),t.ctx.fillStyle=a}t.ctx.fillRect(e,r,n,o),t.ctx.strokeStyle=this.colors.dark,t.ctx.beginPath(),t.ctx.moveTo(e,r),t.ctx.lineTo(e,r+o),t.ctx.moveTo(e+n,r),t.ctx.lineTo(e+n,r+o),t.ctx.stroke()},computeCoords:function(t,e,r,n,o,a){var i=this.file[1]-r,s=Math.floor(i/864e5),l=t.x+(i-864e5*s)/864e5*t.w;if(this.attr({x:l,y:t.y+e.pad+s*e.h+n*this._h}),this.file[0]<this.file[1]){var c=this.file[1]-r,u=t.x+(c-864e5*s)/864e5*t.w;this.w=u-l}return o>1&&(this.h=this._h/o,this.y=this._y+this._h*a),this},showTooltip:function(){var t='<div class="tooltip">\n            <div class="filename">'.concat(this.file[0],"</div>\n            <table>\n            <tr><td>dataProduct:</td><td>").concat(this.dp.dataProductCode,"</td></tr>\n            <tr><td>extension:</td><td>").concat(this.dp.extension,"</td></tr>\n            <tr><td>dateFrom:</td><td>").concat(S()(this.file[1]).utc().format("YYYY-MM-DD HH:mm:ss"),"</td></tr>\n            <tr><td>dateTo:</td><td>").concat(S()(this.file[2]).utc().format("YYYY-MM-DD HH:mm:ss"),"</td></tr>\n            <tr><td>period:</td><td>").concat(E(this.dp.period/1e3),"</td></tr>\n            <tr><td>size:</td><td>").concat(V(this.file[3]),"</td></tr>\n            </table>\n            </div>");this.e_tooltip=Crafty.e("Tooltip, Delay").Tooltip(t,{x:this._x+Crafty.viewport.x,y:this._y,w:this._w,h:this._h}),this.e_tooltip.delay((function(){this.fadeIn()}),100)},hideTooltip:function(){this.e_tooltip&&(this.e_tooltip.fadeOut(),this.e_tooltip=null)}}),Crafty.c("Tooltip",{init:function(){return this.addComponent("UI, Tween, 2D, HTML"),this},Tooltip:function(t,e){return this.target=e,this.replace(t),this.attr({w:256,h:140,alpha:0}),this.position(),this},position:function(){var t=this.target,e=this.w,r=this.h,n=Crafty.viewport.width,o=Crafty.viewport.height,a=t.x+t.w/2<n/2,i=t.y<.5*o;this.x=a?t.x+t.w+4:t.x-e-4,this.y=i?t.y+t.h+4:t.y-r-4},fadeIn:function(){return this.alpha=0,this.addComponent("Visible"),this.tween({alpha:1},100,"linear"),this},fadeOut:function(){return this.destroy(),this}})},Legend:function(t,e,r,n){var o=r.length;this.e_labels=Array(o),this.attr({x:0,y:0,w:e.w,h:32});for(var a=this._x+10,i=this._y,s=0;s<o;s++)this.e_labels[s]=Crafty.e("Label").Label(a,i,r[s],n),a=this.e_labels[s].x+this.e_labels[s].w+this.layout.lblMargin;return this}})}var ge,we,be=(pe=function(){function t(e,r,n){o()(this,t),this.dom={base:e,track:null,bar:null};var a=r.cw-r.margin.left;this.layout={x:n.x,h:20,trackw:a,barw:0,aMargin:r.margin},this.bar={x:0,value:0,minX:this.layout.x,maxX:0,hasMouseDown:!1,downX:0},this.worldMaxX=0}return i()(t,[{key:"computeLayout",value:function(){var t=this.layout,e=-Crafty.viewport.x,r=Crafty.viewport.bounds.max.x;this.worldMaxX=r-t.trackw,t.barw=t.trackw/r*t.trackw,this.bar.maxX=t.trackw-t.barw,this.bar.x=e/r*this.bar.maxX}},{key:"updateBarLayout",value:function(){var t=this.layout;this.dom.bar.style.width="".concat(t.barw,"px"),this.dom.bar.style.left=this.bar.x+"px",this.dom.track.style.display=t.barw>=t.trackw?"none":"block"}},{key:"render",value:function(){var t=this.layout;this.computeLayout();var e=document.createElement("div");e.className="ScrollBar",e.style.width="".concat(t.trackw,"px"),e.style.height="".concat(t.h,"px"),e.style.marginLeft="".concat(t.x,"px"),this.dom.base.appendChild(e),this.dom.track=e;var r=document.createElement("div");r.className="bar",e.appendChild(r),this.dom.bar=r,this.updateBarLayout(),r.addEventListener("mousedown",this.mousedown),r.addEventListener("mouseenter",(function(){Crafty("Tooltip").destroy()}))}},{key:"update",value:function(){this.computeLayout(),this.updateBarLayout()}},{key:"mousedown",value:function(t){this.bar.downX=t.clientX-this.bar.minX-this.bar.x,this.bar.hasMouseDown=!0,document.addEventListener("mousemove",this.mousemove),document.addEventListener("mouseup",this.mouseup)}},{key:"mouseup",value:function(t){this.bar.hasMouseDown=!1,document.removeEventListener("mousemove",this.mousemove),document.removeEventListener("mouseup",this.mouseup)}},{key:"mousemove",value:function(t){if(this.bar.hasMouseDown){var e=t.clientX-this.bar.minX-this.bar.downX;e<0?e=0:e>this.bar.maxX&&(e=this.bar.maxX),this.bar.x=e,this.bar.value=e/this.bar.maxX,this.dom.bar.style.left=e+"px",Crafty.viewport.x=-this.bar.value*this.worldMaxX}}}]),t}(),l()(pe.prototype,"computeLayout",[u],Object.getOwnPropertyDescriptor(pe.prototype,"computeLayout"),pe.prototype),l()(pe.prototype,"render",[u],Object.getOwnPropertyDescriptor(pe.prototype,"render"),pe.prototype),l()(pe.prototype,"update",[u],Object.getOwnPropertyDescriptor(pe.prototype,"update"),pe.prototype),l()(pe.prototype,"mousedown",[u],Object.getOwnPropertyDescriptor(pe.prototype,"mousedown"),pe.prototype),l()(pe.prototype,"mouseup",[u],Object.getOwnPropertyDescriptor(pe.prototype,"mouseup"),pe.prototype),l()(pe.prototype,"mousemove",[u],Object.getOwnPropertyDescriptor(pe.prototype,"mousemove"),pe.prototype),pe),xe=(ge=function(){function t(e,r,n,a){o()(this,t),this.filters=n,this.dom={base:r,crafty:null},this.getFileUrl="https://data.oceannetworks.ca/api/archivefiles?method=getFile&token=".concat(e.token),this.layout={cw:a.width,ch:a.height,w0:24*a.colWidth,w:0,h:a.height,zoom:3,zoomFactors:[.2,.4,.8,1,1.5,2.5,4,6],margin:{top:46,bottom:10,left:44},area:null,day:null,colors:{grid:"#888",background:"#222"}};var i=this.layout;this.layout.area={h:i.h-i.margin.top-i.margin.bottom,w:0,x:i.margin.left,y:i.margin.top},this.days=null,this.range={min:0,max:0,dayMin:0,dayMax:0},this.e_xAxis=null,this.scrollbar=null,this.data=[]}return i()(t,[{key:"computeDayRanges",value:function(){var t=this.layout.area,e=S()(this.range.min).utc(),r=S()(this.range.max).utc(),n=F(e),o=F(r.add(1,"day"));this.days=function(t,e){var r=[],n=F(t),o=n.add(1,"day");if(o>e)return[{dateFrom:t,dateTo:e}];for(var a=n;o<e;)r.push({dateFrom:a,dateTo:o}),a=a.add(1,"day"),o=o.add(1,"day");return a<e&&r.push({dateFrom:a,dateTo:e}),r}(n,o);var a=this.days.length;this.layout.day={h:t.h/a,cellw:0,count:a,pad:2},this.range.dayMin=n.valueOf(),this.range.dayMax=o.valueOf()}},{key:"zoomUpdateLayout",value:function(){var t,e=this.layout,r=e.area,n=e.cw-r.x,o=Crafty.viewport.x,a=!1;0!=o&&(a=!0,t=(Math.abs(o)+n/2+r.x)/e.w);var i=e.zoomFactors[e.zoom];if(e.w=i*e.w0,r.w=i*e.w0,e.day.cellw=r.w/24,Crafty.viewport.bounds={min:{x:0,y:0},max:{x:e.w,y:e.h}},a){var s=t*r.w-n/2-r.x;s<0?s=0:s+n>r.w&&(s=r.w-e.cw),Crafty.viewport.x=-s}this.scrollbar&&this.scrollbar.update()}},{key:"zoomIncrement",value:function(t){var e=this.layout,r=e.zoom,n=e.zoomFactors,o=r+t;o>=0&&o<n.length&&(e.zoom+=t,this.zoomUpdateLayout(),this.drawXaxis(e.area,e.day),this.renderElements(e.area,e.day))}},{key:"zoomIn",value:function(){this.zoomIncrement(1)}},{key:"zoomOut",value:function(){this.zoomIncrement(-1)}},{key:"display",value:function(t){this.gatherData(t),this.computeDayRanges(),this.zoomUpdateLayout();var e=this.layout,r=e.area,n=e.day;this.initCrafty(e,r),this.drawYaxis(r,n),this.drawXaxis(r,n),this.renderElements(r,n),this.scrollbar=new be(this.dom.base,e,r),this.scrollbar.render()}},{key:"initCrafty",value:function(t,e){var r=document.createElement("div");r.classList.add("crafty","unselectable"),this.dom.base.appendChild(r),this.dom.crafty=r,Crafty.init(t.cw,t.ch,r),Crafty.viewport.bounds={min:{x:0,y:0},max:{x:t.w0,y:t.h}},Crafty.createLayer("UI","DOM",{scaleResponse:0,xResponse:0,yResponse:0,z:40}),me(),Crafty.e("UI, 2D, Color, Mouse").attr({x:0,y:0,w:e.x,h:t.ch}).color("#FFF").bind("MouseOver",(function(t){t.originalEvent.stopPropagation()}));var n=[];for(var o in this.data)n.push({key:o,dataProductCode:this.data[o].dataProductCode,extension:this.data[o].extension,colors:this.data[o].colors});Crafty.e("Legend").Legend(t,e,n,this.toggleDp);var a=t.cw-16;this.e_btZIn=Crafty.e("UI, 2D, Mouse, btZoomIn").attr({x:a,y:8,w:16,h:16,z:10}).bind("Click",this.zoomIn),this.e_btZOut=Crafty.e("UI, 2D, Mouse, btZoomOut").attr({x:a-24,y:8,w:16,h:16,z:10}).bind("Click",this.zoomOut)}},{key:"toggleDp",value:function(t){this.data[t].visible=!this.data[t].visible,this.renderElements(this.layout.area,this.layout.day)}},{key:"renderElements",value:function(t,e){var r=0;for(var n in this.data)this.data[n].visible&&r++;if(Crafty("File").destroy(),0!=r){var o,a,i,s=(e.h-2*e.pad)/r,l=this.range.dayMin,c=0,u=1,d=0;for(var h in this.data){var p=this.data[h];if(p.visible){o=p.period/864e5*t.w,a=p.items.length;for(var f=0;f<a;f++){if(1==u&&f+1<a&&p.items[f][1]==p.items[f+1][1])for(d=0,i=f+1;i<a&&p.items[f][1]==p.items[i][1];)i++,u++;Crafty.e("File").File(p.items[f],p,o,s,p.colors,this.getFileUrl).computeCoords(t,e,l,c,u,d),u>1&&++d==u&&(u=1,d=0)}c++}}}}},{key:"drawYaxis",value:function(t,e){for(var r,n=t.y+.5*e.h,o=this.layout.colors,a=0;a<=e.count;a++)a<e.count&&(r=this.days[a].dateFrom.format("MMM-DD"),Crafty.e("UI, 2D, Text, Color, Mouse").attr({x:0,y:n,h:22,w:t.x-3}).text(r).textAlign("right").bind("MouseOver",(function(t){t.originalEvent.stopPropagation()}))),Crafty.e("UI, 2D, Color").attr({x:t.x-36,y:t.y+a*e.h,w:t.w+36,h:1}).color(o.grid),n+=e.h}},{key:"drawXaxis",value:function(t,e){this.e_xAxis&&this.e_xAxis.destroy();var r=this.layout.colors,n="",o=t.y;this.e_xAxis=Crafty.e("2D, Canvas, Color"),this.e_xAxis.attr({x:t.x,y:o,w:t.w,h:1}),this.e_xAxis.color(r.grid);var a=Crafty.e("Canvas, 2D, Color").attr({x:t.x,y:t.y,w:t.w,h:t.h}).color(r.background);this.e_xAxis.attach(a);for(var i=e.cellw,s=.5*i,l=t.x+s,c=0;c<=24;c++){if(c<24){n=c<10?"0".concat(c,":00"):"".concat(c,":00");var u=Crafty.e("2D, Canvas, Text");u.attr({x:l+c*i,y:o-14}).text(n).textAlign("center"),this.e_xAxis.attach(u)}this.e_xAxis.attach(Crafty.e("2D, Canvas, Color").attr({x:t.x+c*i,y:o-14,w:1,h:t.h+14}).color(r.grid))}}},{key:"gatherData",value:function(t){for(var e=[],r=[],n=99999999999999,o=0,a="",i=t.length,s=0;s<i;s++)a="".concat(t[s].dataProductCode,".").concat(t[s].extension),-1==e.indexOf(a)?(this.data[a]={dataProductCode:t[s].dataProductCode,extension:t[s].extension,period:0,items:[],colors:null,visible:!0},e.push(a),r[a]=[t[s].dateFrom],this.addItem(a,t[s])):(r[a].push(t[s].dateFrom),this.addItem(a,t[s])),t[s].dateFrom<n&&(n=t[s].dateFrom),t[s].dateTo>o&&(o=t[s].dateTo);this.range.min=n,this.range.max=o;for(var l=0,c=0,u=e;c<u.length;c++){var d=u[c],h=Pt(d);l=this.getTimePeriod(r[d]),this.data[d].period=l>0?l:36e5,this.data[d].colors={dark:h,normal:Mt(h,.7),light:Mt(h,.9)}}}},{key:"addItem",value:function(t,e){this.data[t].items.push([e.filename,e.dateFrom,e.dateTo,e.uncompressedFileSize])}},{key:"getTimePeriod",value:function(t){var e,r=new Map,n=t.length;if(1==n)return 0;for(var o=1;o<n;o++)e=t[o]-t[o-1],r.has(e)?r.set(e,r.get(e)+1):r.set(e,1);var a=0,i=0,s=!0,l=!1,c=void 0;try{for(var u,d=r[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var h=ve()(u.value,2),p=h[0],f=h[1];p>0&&f>a&&(a=f,i=p)}}catch(t){l=!0,c=t}finally{try{s||null==d.return||d.return()}finally{if(l)throw c}}return i}}]),t}(),l()(ge.prototype,"zoomIncrement",[u],Object.getOwnPropertyDescriptor(ge.prototype,"zoomIncrement"),ge.prototype),l()(ge.prototype,"zoomIn",[u],Object.getOwnPropertyDescriptor(ge.prototype,"zoomIn"),ge.prototype),l()(ge.prototype,"zoomOut",[u],Object.getOwnPropertyDescriptor(ge.prototype,"zoomOut"),ge.prototype),l()(ge.prototype,"toggleDp",[u],Object.getOwnPropertyDescriptor(ge.prototype,"toggleDp"),ge.prototype),ge);S.a.extend(L.a);var ke,Ce=(we=function(t){function e(t,r){var n;o()(this,e),n=w()(this,x()(e).call(this,t,r));var a,i,s,l,c=(a=n.dom.base.parentElement,i=getComputedStyle(a),s=a.clientHeight,l=a.clientWidth,s-=parseFloat(i.paddingTop)+parseFloat(i.paddingBottom),{width:l-=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight),height:s}).width,u=(c-44)/24;return n.layout={width:parseFloat(n.getOption("width",c),10),height:parseFloat(n.getOption("height",520),10),colWidth:parseFloat(n.getOption("colWidth",u),10),iframe:document.querySelectorAll(".oncWidget[data-widget=archiveMap]").length>1},n.map=new xe(r,n.dom.content,n.filters,n.layout),n.filters.returnOptions="all",n.ds=new le(r,n.filters,n.showLoader),n.ds.parseDates=!0,n}return C()(e,t),i()(e,[{key:"download",value:function(){return this.layout.iframe?new Promise((function(t){return t()})):this.ds.download()}},{key:"renderContents",value:function(){if(this.hideLoader(),this.layout.iframe){for(var t,e,r=this.dom.base.attributes,n="",o=0;o<r.length;o++)t=r[o].name,""==(e=(e=r[o].value).replace(/\s/g,""))||["data-widget","class"].includes(t)||("options"==t&&(e=e.replace("iframe:true","")).endsWith(",")&&(e=e.substr(0,e.length-1)),n+="+".concat(t,"+").concat(e));var a=document.createElement("iframe");a.className="archiveMap",a.width=this.layout.width,a.height=this.layout.height+30,a.src="http://onc.danycabrera.com/assets/archiveMap.html?token=".concat(this._onc.token,"&widgets=archiveMap").concat(n),this.dom.content.appendChild(a)}else{if(!this.ds.hasData())return void this.showStatus("info","No data found for the filters provided.");this.map.display(this.ds.data)}}}]),e}(dt),l()(we.prototype,"download",[u],Object.getOwnPropertyDescriptor(we.prototype,"download"),we.prototype),l()(we.prototype,"renderContents",[u],Object.getOwnPropertyDescriptor(we.prototype,"renderContents"),we.prototype),we),De=(ke=function(){function t(){o()(this,t),this._widgets=[],this._maxThreads=5,this._freeThreads=this._maxThreads,this._widgetsLoaded=0;var e=document.getElementById("oncdw");if(e&&e.dataset&&e.dataset.token)this._token=e.dataset.token;else{var r=new URL(window.location.href).searchParams.get("token");this._token=r||""}this._onc=new m(this._token),document.addEventListener("click",(function(t){document.querySelectorAll(".oncWidget div.header div.menu").forEach((function(t,e){t.classList.remove("active")}))}));var n=document.createElement("img");n.onerror=function(){var t=document.createElement("style");t.type="text/css",t.innerHTML='.oncWidget > .header > .menu button { background-image = url("'.concat(h.serverUrl,'/assets/sprite.png"); }'),document.head.appendChild(t)},n.src="/assets/sprite.png"}return i()(t,[{key:"detectWidgets",value:function(){var t=this;this.parseUrlWidgets(),document.querySelectorAll(".oncWidget").forEach((function(e){var r,n=e.dataset.widget;try{switch(n){case"version":r=new vt(e,"version");break;case"plot":r=new Wt(e,t._onc);break;case"rtplot":r=new Kt(e,t._onc);break;case"image":r=new oe(e,t._onc);break;case"download":r=new ae(e,t._onc);break;case"rawValue":r=new se(e,t._onc);break;case"locationsTree":r=new gt(e,t._onc);break;case"locations":r=new wt(e,t._onc);break;case"devices":r=new xt(e,t._onc);break;case"deployments":r=new Ct(e,t._onc);break;case"deviceCategories":r=new bt(e,t._onc);break;case"properties":r=new kt(e,t._onc);break;case"dataProducts":r=new Dt(e,t._onc);break;case"archiveFiles":r=new de(e,t._onc);break;case"archiveGif":r=new he(e,t._onc);break;case"archiveDays":r=new fe(e,t._onc);break;case"archiveMap":r=new Ce(e,t._onc);break;default:throw new Error("This widget requires a valid <b>data-widget</b> attribute.")}}catch(t){console.log(t),r=new vt(e,"error",t.message)}t._widgets.push(r);var o=t._widgets.length-1;t._widgets[o].idx=o,t._widgets[o].dom.base.classList.add("wid_".concat(o))}));var e=new Event("OncAllWidgetsParsed");document.dispatchEvent(e)}},{key:"parseUrlWidgets",value:function(){var t=new URL(window.location.href).searchParams.get("widgets");if(null!=t){for(var e=t.split(" "),r={"data-widget":e[0]},n=1;n<e.length;n+=2)r[e[n]]=e[n+1];var o=document.createElement("section");for(var a in o.className="oncWidget",r)o.setAttribute(a,r[a]);document.body.appendChild(o)}}},{key:"processWidgets",value:function(){for(var t=this,e=this._widgets.length,r=this._maxThreads,n=0,o=r;o<e;o++)this._widgets[o].showLoader("waiting","Waiting for other widgets");for(n=0;n<e&&n<r;n++)this.processWidget(n);if(n<e)var a=window.setInterval((function(){for(;n<e&&t._freeThreads>0;)t.processWidget(n),n++;n>=e&&clearInterval(a)}),200)}},{key:"processWidget",value:function(t){var e=this,r=this._widgets[t];r&&!r.cancelled?(this._freeThreads--,r.download().then((function(t){r.render(),e._freeThreads++,e._widgetsLoaded++,e.cbkWidgetLoaded(r.idx,e._widgetsLoaded)}),(function(t){e.showWidgetError(r,t),e._freeThreads++,e._widgetsLoaded++,e.cbkWidgetLoaded(r.idx,e._widgetsLoaded)}))):(this._widgetsLoaded++,this.cbkWidgetLoaded(r.idx,this._widgetsLoaded))}},{key:"cbkWidgetLoaded",value:function(t,e){document.dispatchEvent(new CustomEvent("OncWidgetDownloaded",{detail:{idx:t,downloaded:e,total:this._widgets.length}})),this._widgets[t].cancelled&&this._widgets[t].dom.base.classList.add("cancelled")}},{key:"showWidgetError",value:function(t,e){"empty"==e?t.showStatus("info","The server responded with an empty data set."):"canceled"==e?this.showStatus("info","Download process canceled."):e.response&&e.response.data?t.showStatus("api_error",this._onc.errorToString(e)):(console.log(e),t.showStatus("error",e.message))}}]),t}(),l()(ke.prototype,"processWidget",[u],Object.getOwnPropertyDescriptor(ke.prototype,"processWidget"),ke.prototype),ke);r(66);document.addEventListener("DOMContentLoaded",(function(){window.OncDW=new De,window.OncDW.detectWidgets(),window.OncDW.processWidgets()}))}]);

